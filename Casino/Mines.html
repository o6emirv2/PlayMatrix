<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<title>PlayMatrix Mines | Ücretsiz Online Mayın Oyunu ve Casino</title>
<meta name="description" content="PlayMatrix Mines oyna! Elmasları bul, mayınlardan kaç ve çarpanı artırarak MC kazan. Ücretsiz, kesintisiz online casino ve mayın tarlası heyecanına hemen katıl.">
<meta name="keywords" content="mines oyna, online mayın tarlası, casino oyunları, ücretsiz mines, PlayMatrix, mc kazan, mayın oyunu, şans oyunları">
<meta name="author" content="PlayMatrix Global">
<meta name="robots" content="index, follow">
<meta name="language" content="Turkish">
<meta name="theme-color" content="#020408">
<link rel="canonical" href="https://playmatrix.com.tr/Mines.html">

<meta property="og:title" content="PlayMatrix Mines | Elmasları Bul, MC Kazan">
<meta property="og:description" content="Mayınlara basmadan elmasları topla, çarpanını artır ve kazancını anında çek. Heyecan dolu Mines oyunu seni bekliyor!">
<meta property="og:image" content="https://playmatrix.com.tr/assets/mines-promo.jpg">
<meta property="og:url" content="https://playmatrix.com.tr/Mines.html">
<meta property="og:type" content="website">
<meta property="og:site_name" content="PlayMatrix">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PlayMatrix Mines Oyna">
<meta name="twitter:description" content="Şansını ve sezgilerini test et. Mayınlardan kaç, elmasları bularak MC bakiyeni katla!">

<script>
    if (window.history.replaceState) {
        // Mines.html yazısını silip sadece playmatrix.com.tr görünmesini sağlar
        window.history.replaceState(null, null, "/");
    }
</script>

<style>
    /* RESET & TEMEL STİLLER */
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
    html,body{
        height:100%; overflow:hidden; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
        background: #020408; color:white;
    }

    /* SEO İÇİN GİZLİ H1 SINIFI (Tasarımı bozmaz, Google okur) */
    .sr-only {
        position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
        overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
    }

    /* TOP BAR */
    .top-bar{
        position:fixed;top:0;width:100%;height:70px;
        display:flex;align-items:center;justify-content:space-between;
        padding:0 15px; background: rgba(0,0,0,0.95);
        border-bottom: 2px solid #4fd1ff; z-index:1000;
    }

    .brand{
        font-family: -apple-system, sans-serif; font-size:1.1rem; font-weight:900; color:#4fd1ff;
        letter-spacing: 1px;
    }

    .right-menu{display:flex;gap:8px;align-items: center;}
    
    .user-pill-mini { 
        display: flex; align-items: center; gap: 8px; 
        background: rgba(255,255,255,0.05); padding: 5px 12px; 
        border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); 
        height: 38px;
    }
    .balance-info { display: flex; align-items: center; }
    .balance-info b { font-size: 14px; color: #00ffa3; font-weight: 700; }
    .mc-chip {
        width: 22px; height: 22px;
        background: radial-gradient(circle at 30% 30%, #4fd1ff, #0055ff);
        border-radius: 50%; margin-left: 6px;
        display: flex; align-items: center; justify-content: center;
        font-size: 8px; font-weight: 900; color: #fff;
        box-shadow: 0 0 10px rgba(79, 209, 255, 0.3);
        border: 1.2px solid rgba(255,255,255,0.2);
    }

    .back-btn {
        background: #ff3b30; color: white; text-decoration: none; padding: 8px 12px;
        border-radius: 4px; font-size: 0.7rem; font-weight: 900; 
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        height: 32px; display: flex; align-items: center; margin-left: 5px;
    }

    /* OYUN ALANI */
    .container{
        position:absolute;top:70px;bottom:0;width:100%;
        display:flex;flex-direction:column;padding:15px;overflow-y:auto;
        background-color: #020408;
        background-image: 
            radial-gradient(at 0% 0%, hsla(225,39%,10%,1) 0, transparent 50%), 
            radial-gradient(at 50% 0%, hsla(225,39%,15%,1) 0, transparent 50%), 
            radial-gradient(at 100% 0%, hsla(225,39%,10%,1) 0, transparent 50%), 
            radial-gradient(at 50% 50%, hsla(225,39%,5%,1) 0, transparent 100%),
            linear-gradient(180deg, #020408 0%, #0a0f1e 100%);
        background-attachment: fixed;
    }

    .container::before {
        content: "";
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle at 50% 50%, rgba(79, 209, 255, 0.03) 0%, transparent 70%);
        pointer-events: none;
        animation: pulseBg 8s infinite alternate;
    }

    @keyframes pulseBg {
        0% { opacity: 0.5; transform: scale(1); }
        100% { opacity: 1; transform: scale(1.2); }
    }

    .mines-header{
        display:flex;justify-content:space-between;align-items:center;
        background:rgba(26, 34, 72, 0.4); padding:12px 15px; border-radius:14px; 
        margin-bottom:15px; border: 1px solid rgba(79, 209, 255, 0.1);
        backdrop-filter: blur(5px);
        z-index: 2;
    }
    
    #grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:20px; z-index: 2;}
    
    .tile{
        background: rgba(22, 29, 54, 0.7); height: 65px; border-radius: 12px; 
        display: flex; align-items: center; justify-content: center; 
        font-size: 24px; cursor: pointer; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(39, 60, 143, 0.5);
        backdrop-filter: blur(2px);
    }

    .tile.active-hover:hover {
        background: rgba(30, 40, 75, 0.9);
        border-color: #4fd1ff;
        transform: translateY(-2px);
    }

    .tile.open{ 
        background: linear-gradient(145deg, #00b894, #00d2ad); 
        border-color: #55efc4; 
        box-shadow: 0 0 15px rgba(0, 184, 148, 0.4);
        animation: flip 0.4s; 
        cursor: default;
    }
    
    .tile.mine{ 
        background: linear-gradient(145deg, #d63031, #ff7675); 
        border-color: #ff7675; 
        box-shadow: 0 0 20px rgba(214, 48, 49, 0.5);
        animation: shake 0.3s; 
        cursor: default;
    }

    /* Oyun bitince açılmayanları soluk göstermek için */
    .tile.dimmed-diamond {
        background: rgba(22, 29, 54, 0.3);
        border-color: rgba(39, 60, 143, 0.2);
        opacity: 0.5;
        cursor: default;
    }
    
    .tile.dimmed-mine {
        background: rgba(214, 48, 49, 0.2);
        border-color: rgba(214, 48, 49, 0.3);
        opacity: 0.7;
        cursor: default;
    }

    @keyframes flip { 0% {transform: rotateY(90deg);} 100% {transform: rotateY(0deg);} }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)}}

    .bet-panel{
        background: rgba(10, 15, 30, 0.85); 
        border-top: 1px solid rgba(79, 209, 255, 0.1);
        padding: 20px 15px; margin: auto -15px 0 -15px;
        display: flex; flex-direction: column; gap: 10px;
        backdrop-filter: blur(10px);
        z-index: 10;
    }

    input, select{
        width:100%; background: rgba(5, 8, 17, 0.8); border: 1px solid #273c8f; 
        border-radius:12px; padding:12px; color:white; 
        font-weight: bold; font-size:16px; outline:none; text-align: center;
        -webkit-appearance: none;
        transition: border-color 0.3s;
    }

    input:focus { border-color: #4fd1ff; }
    input:disabled, select:disabled { opacity: 0.5; cursor: not-allowed; }

    button{
        width:100%; padding:15px; border-radius:12px; border:none; 
        font-weight:900; cursor:pointer; font-size:16px; 
        background: linear-gradient(180deg, #6c5ce7 0%, #5743d6 100%);
        color:white; transition: 0.2s;
        box-shadow: 0 4px 15px rgba(87, 67, 214, 0.3);
    }

    button:active { transform: scale(0.98); }
    button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .start-active{ background: linear-gradient(180deg, #00d2ad 0%, #00b894 100%) !important; box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3); }
    .is-lose{ background: linear-gradient(180deg, #ff7675 0%, #d63031 100%) !important; box-shadow: 0 4px 15px rgba(214, 48, 49, 0.3); }

    /* UYARI / BİLGİ MODALI */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
        display: none; align-items: center; justify-content: center; z-index: 2000;
    }
    .modal-content {
        background: #161d36; border: 2px solid #273c8f; border-radius: 20px;
        width: 85%; max-width: 320px; padding: 25px; text-align: center;
        box-shadow: 0 0 30px rgba(0,0,0,0.5); animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .modal-icon { font-size: 40px; margin-bottom: 15px; color: #ff2a4d; }
    .modal-text { font-weight: 700; font-size: 16px; line-height: 1.5; margin-bottom: 20px; }
    .modal-btn {
        background: #4fd1ff; color: #000; padding: 10px 25px; border-radius: 10px;
        font-weight: 900; border: none; cursor: pointer; width: auto !important;
    }
    
    @keyframes pop { 0% {transform: scale(0.8); opacity: 0;} 100% {transform: scale(1); opacity: 1;} }

    /* YENİ: SİSTEM BAŞLATMA OVERLAY EKRANI (SES KİLİDİ İÇİN) */
    .start-overlay {
        position: fixed; inset: 0; background: rgba(2,4,10,0.95);
        display: flex; align-items: center; justify-content: center;
        z-index: 9999; backdrop-filter: blur(10px); flex-direction: column;
    }
    .start-modal {
        background: rgba(10,15,25,0.95); padding: 40px; border-radius: 20px; 
        text-align: center; border: 2px solid #4fd1ff; box-shadow: 0 0 30px rgba(79,209,255,0.2);
        width: 85%; max-width: 350px;
    }
</style>
</head>
<body>

<h1 class="sr-only">PlayMatrix Mines - Ücretsiz Online Mayın Oyunu ve Casino</h1>

<div id="sys-start-overlay" class="start-overlay">
    <div class="start-modal">
        <h2 style="font-family:'Orbitron', sans-serif; color:#4fd1ff; font-size: 24px; margin-bottom: 10px; text-shadow: 0 0 15px rgba(79,209,255,0.5);">MİNES PROTOKOLÜ</h2>
        <p style="font-size: 12px; color: #94a3b8; margin-bottom: 25px;">Sesleri ve oyun motorunu aktifleştirmek için sistemi başlatın.</p>
        <button id="systemStartBtn" aria-label="Oyunu Başlat" style="width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(90deg, #00ffa3, #00b894); color: #000; font-weight: 900; font-size: 16px; cursor: pointer;">SİSTEMİ BAŞLAT</button>
    </div>
</div>

<header class="top-bar">
    <div class="brand">MİNES</div>
    <nav class="right-menu" aria-label="Kullanıcı Menüsü">
        <div class="user-pill-mini">
            <div class="balance-info">
                <b id="userBalance">0</b>
                <div class="mc-chip">MC</div>
            </div>
        </div>
        
        <div class="user-pill-mini" style="border-color: #ffcc00;">
            <div class="balance-info">
                <b id="currentBet" style="color:#ffcc00">0</b>
                <div class="mc-chip" style="background: radial-gradient(circle at 30% 30%, #ffcc00, #ff8a00); box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);">MC</div>
            </div>
        </div>

        <a href="index.html" class="back-btn" aria-label="Ana Sayfaya Dön">GERİ</a>
    </nav>
</header>

<main class="container">
    <div class="mines-header">
        <div style="font-weight: 800; color: #4fd1ff; font-size: 14px; letter-spacing: 0.5px;">MULTIPLIER: <span id="multiplierDisplay" style="color:white;" aria-live="polite">1.00x</span></div>
        <div style="color:#aaa; font-size: 12px; font-weight: 700;">MAYIN: <span id="mineDisplay" style="color:#ff2a4d;">3</span></div>
    </div>
    
    <div id="grid" role="grid" aria-label="Mines Oyun Tahtası"></div>
    
    <div class="bet-panel">
        <input type="number" id="bet" placeholder="Bahis Miktarı" value="250" inputmode="numeric" aria-label="Bahis Miktarını Girin">
        <select id="mineCount" aria-label="Mayın Sayısını Seçin"></select>
        <button id="startBtn" aria-label="Bahsi Başlat veya Çek">MC KULLAN</button>
    </div>
</main>

<div id="alertModal" class="modal-overlay" aria-hidden="true" aria-live="assertive">
    <div class="modal-content">
        <div class="modal-icon" id="modalIcon">⚠️</div>
        <div class="modal-text" id="modalMsg">Hata oluştu.</div>
        <button class="modal-btn" onclick="closeModal()" aria-label="Kapat">TAMAM</button>
    </div>
</div>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
  authDomain:"emirhan-site.firebaseapp.com",
  projectId:"emirhan-site",
  storageBucket:"emirhan-site.firebasestorage.app",
  messagingSenderId:"668871888390",
  appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
let user=null;

const balanceEl=document.getElementById("balance");
const betEl=document.getElementById("betAmount");
const msgEl=document.getElementById("message");

const betInput=document.getElementById("betInput");
const minesSelect=document.getElementById("mineCount");
const startBtn=document.getElementById("startGame");
const cashoutBtn=document.getElementById("cashoutBtn");
const gridEl=document.getElementById("grid");
const multEl=document.getElementById("multiplier");
const profitEl=document.getElementById("profit");

let st=null;
let busy=false;

function fmt(n){ return Number(n||0).toLocaleString('tr-TR'); }
async function token(){ return await user.getIdToken(); }
async function api(path, body){
  const t = await token();
  const r = await fetch(path,{method:"POST",headers:{'Content-Type':'application/json','Authorization':'Bearer '+t},body:JSON.stringify(body||{})});
  return await r.json();
}
async function apiGet(path){
  const t = await token();
  const r = await fetch(path,{headers:{'Authorization':'Bearer '+t}});
  return await r.json();
}

function setBusy(b){
  busy=b;
  startBtn.disabled=b;
  cashoutBtn.disabled=b;
}

function buildGrid(){
  gridEl.innerHTML="";
  for(let i=0;i<25;i++){
    const d=document.createElement("div");
    d.className="cell";
    d.setAttribute("data-idx", String(i));
    d.onclick=()=>onCell(i, d);
    gridEl.appendChild(d);
  }
}

function applyState(s){
  if(!s) return;
  if(s.ok===false){ msgEl.innerText = s.error || "Hata"; return; }
  st=s;
  balanceEl.innerText = fmt(s.balance||0);
  betEl.innerText = fmt(s.bet||0);
  msgEl.innerText = s.message || "";
  multEl.innerText = (Number(s.multiplier||1)).toFixed(2)+"x";
  profitEl.innerText = fmt(s.cashoutAmount||0);
  cashoutBtn.style.display = s.canCashout ? "block" : "none";
  startBtn.style.display = s.gameState==="betting" ? "block" : "none";
  betInput.disabled = s.gameState!=="betting";
  minesSelect.disabled = s.gameState!=="betting";
  if(s.gameState==="betting"){
    // reset
    buildGrid();
    [...gridEl.children].forEach(c=>c.className="cell");
  }
  if(s.revealed){
    for(const item of s.revealed){
      const cell = gridEl.querySelector(`[data-idx="${item.idx}"]`);
      if(!cell) continue;
      if(item.type==="safe"){ cell.classList.add("safe"); cell.innerText="✓"; }
      if(item.type==="mine"){ cell.classList.add("mine"); cell.innerText="✕"; }
    }
  }
}

async function onCell(i, el){
  if(busy) return;
  if(!st || st.gameState!=="playing") return;
  if(el.classList.contains("safe") || el.classList.contains("mine")) return;
  setBusy(true);
  const r = await api("/api/mines/reveal",{ index:i });
  setBusy(false);
  applyState(r);
}

startBtn.onclick = async ()=>{
  if(busy) return;
  const bet = parseInt(betInput.value,10);
  const mines = parseInt(minesSelect.value,10);
  setBusy(true);
  const r = await api("/api/mines/start",{ bet, mines });
  setBusy(false);
  applyState(r);
};

cashoutBtn.onclick = async ()=>{
  if(busy) return;
  setBusy(true);
  const r = await api("/api/mines/cashout",{});
  setBusy(false);
  applyState(r);
};

onAuthStateChanged(auth, async (u)=>{
  if(!u){ await signInAnonymously(auth); return; }
  user=u;
  buildGrid();
  const me = await apiGet("/api/me");
  if(me?.ok) balanceEl.innerText = fmt(me.balance||0);
  const s = await apiGet("/api/mines/state");
  if(s?.ok) applyState(s);
});

</script>
</body>
</html>
