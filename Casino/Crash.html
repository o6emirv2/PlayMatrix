<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>PlayMatrix Crash | Ücretsiz Online Katlama ve Casino Oyunu</title>
    <meta name="description" content="PlayMatrix Crash oyna! Şansını dene, grafiğin yükselişini izle ve patlamadan önce MC'ni katlayarak çek. Kesintisiz, ücretsiz ve online casino deneyimi seni bekliyor.">
    <meta name="keywords" content="crash oyunu, online crash, katlama oyunu, ücretsiz casino, PlayMatrix, mc kazan, tarayıcı oyunları, kripto oyun">
    <meta name="author" content="PlayMatrix Global">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Turkish">
    <meta name="theme-color" content="#02040a">
    <link rel="canonical" href="https://playmatrix.com.tr/Crash.html">

    <meta property="og:title" content="PlayMatrix Crash | Online Katlama Oyunu">
    <meta property="og:description" content="Grafik patlamadan önce kazancını çek, MC'ni anında katla! PlayMatrix'te kesintisiz Crash heyecanına katıl.">
    <meta property="og:image" content="https://playmatrix.com.tr/assets/crash-promo.jpg">
    <meta property="og:url" content="https://playmatrix.com.tr/Crash.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="PlayMatrix">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PlayMatrix Crash Oyna">
    <meta name="twitter:description" content="Bahsini yap, x değerini izle ve zamanında çıkarak MC kazanmaya başla!">

    <script>
        if (window.history.replaceState) {
            // Crash.html yazısını silip sadece playmatrix.com.tr görünmesini sağlar
            window.history.replaceState(null, null, "/");
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Segoe UI', sans-serif; }
        body { background: #02040a; color: white; height: 100vh; overflow: hidden; }

        /* SEO İÇİN GİZLİ H1 SINIFI (Tasarımı bozmaz, Google okur) */
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
        }

        /* ÜST BAR VE MC COIN TASARIMI */
        .top-bar {
            position: fixed; top: 0; width: 100%; height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 12px; background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px); border-bottom: 2px solid #4fd1ff; z-index: 1000;
        }
        .brand { font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 900; background: linear-gradient(90deg, #4fd1ff, #fff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .right-menu { display: flex; gap: 8px; align-items: center; }
        
        .user-pill-mini { 
            display: flex; align-items: center; gap: 8px; 
            background: rgba(255,255,255,0.05); padding: 5px 12px; 
            border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); 
        }
        .balance-info { display: flex; align-items: center; }
        .balance-info b { font-size: 14px; color: #00ffa3; font-family: 'Inter', monospace; font-weight: 700; }
        .mc-chip {
            width: 22px; height: 22px;
            background: radial-gradient(circle at 30% 30%, #4fd1ff, #0055ff);
            border-radius: 50%; margin-left: 6px;
            display: flex; align-items: center; justify-content: center;
            font-size: 8px; font-weight: 900; color: #fff;
            box-shadow: 0 0 10px rgba(79, 209, 255, 0.3);
            border: 1.2px solid rgba(255,255,255,0.2);
            font-family: 'Inter', sans-serif;
        }

        .back-btn { background: #d63031; color: white; padding: 8px 15px; border-radius: 10px; font-weight: 800; font-size: 11px; border: none; cursor: pointer; transition: 0.3s; margin-left: 5px; }

        .history {
            position: fixed; top: 70px; width: 100%; height: 40px;
            display: flex; align-items: center; gap: 8px; padding: 0 15px;
            background: rgba(0,0,0,0.4); overflow-x: auto; scrollbar-width: none; z-index: 900;
        }
        .history span { padding: 4px 10px; border-radius: 8px; font-size: 11px; font-weight: 800; font-family: 'Orbitron'; }

        .game-container { position: absolute; top: 0; left: 0; width: 100%; height: calc(100% - 240px); z-index: 1; }
        canvas { width: 100%; height: 100%; }

        .multiplier-display {
            position: absolute; top: 45%; left: 50%; transform: translate(-50%, -50%);
            text-align: center; pointer-events: none; z-index: 10; width: 100%;
        }
        .x-value { 
            font-family: 'Orbitron', sans-serif; font-size: 80px; font-weight: 900; color: #fff; 
            text-shadow: 0 0 25px rgba(79, 209, 255, 0.7);
        }
        .status-text { font-family: 'Orbitron'; font-size: 14px; color: #4fd1ff; letter-spacing: 3px; margin-bottom: 5px; }
        .crashed-text { color: #ff2a4d !important; text-shadow: 0 0 20px #ff2a4d; animation: shake 0.4s infinite; }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px); } 50% { transform: translate(-2px, -1px); } 100% { transform: translate(1px, 1px); }
        }

        .bottom-panel {
            position: fixed; bottom: 0; width: 100%; height: 240px;
            background: #080c18; border-top: 2px solid #161d36;
            display: flex; justify-content: center; align-items: center; gap: 10px; padding: 15px; z-index: 1000;
        }
        .bet-card {
            background: #111827; flex: 1; max-width: 190px; height: 100%;
            border-radius: 20px; padding: 12px; display: flex; flex-direction: column; gap: 10px;
            border: 1px solid #1f2937;
        }
        .bet-card input {
            width: 100%; background: #030712; border: 2px solid #1f2937; border-radius: 12px;
            color: #4fd1ff; padding: 12px; text-align: center; font-size: 18px; font-weight: 800; font-family: 'Orbitron'; outline: none;
        }
        
        .auto-row { display: flex; justify-content: space-between; align-items: center; background: rgba(0,0,0,0.3); padding: 8px 12px; border-radius: 10px; }
        .auto-row span { font-size: 10px; font-weight: 800; color: #94a3b8; }

        .switch { position: relative; width: 38px; height: 20px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #334155; transition: .4s; border-radius: 20px; }
        .slider:before { position: absolute; content: ""; height: 14px; width: 14px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: #00ffa3; }
        input:checked + .slider:before { transform: translateX(18px); }

        .main-btn {
            width: 100%; flex-grow: 1; border: none; border-radius: 14px; color: white; font-weight: 900;
            font-size: 14px; cursor: pointer; transition: 0.2s;
            text-transform: uppercase; font-family: 'Orbitron';
        }
        .btn-bet { background: linear-gradient(180deg, #6366f1, #4338ca); box-shadow: 0 4px 0 #312e81; }
        .btn-cancel { background: linear-gradient(180deg, #ef4444, #b91c1c); box-shadow: 0 4px 0 #7f1d1d; }
        .btn-cashout { background: linear-gradient(180deg, #10b981, #047857); box-shadow: 0 4px 0 #064e3b; }
        .main-btn:active { transform: translateY(2px); box-shadow: none; }
        .main-btn:disabled { opacity: 0.3; filter: grayscale(1); cursor: not-allowed; }

        @media (max-width: 400px) { .x-value { font-size: 55px; } .bottom-panel { height: 210px; } }

        /* YENİ: SİSTEM BAŞLATMA OVERLAY EKRANI (SES KİLİDİ İÇİN) */
        .start-overlay {
            position: fixed; inset: 0; background: rgba(2,4,10,0.95);
            display: flex; align-items: center; justify-content: center;
            z-index: 9999; backdrop-filter: blur(10px); flex-direction: column;
        }
        .start-modal {
            background: rgba(10,15,25,0.95); padding: 40px; border-radius: 20px; 
            text-align: center; border: 2px solid #4fd1ff; box-shadow: 0 0 30px rgba(79,209,255,0.2);
            width: 85%; max-width: 350px;
        }
    </style>
</head>
<body>

<h1 class="sr-only">PlayMatrix Crash - Ücretsiz Online Katlama Oyunu</h1>

<div id="start-overlay" class="start-overlay">
    <div class="start-modal">
        <h2 style="font-family:'Orbitron'; color:#4fd1ff; font-size: 24px; margin-bottom: 10px; text-shadow: 0 0 15px rgba(79,209,255,0.5);">CRASH PROTOKOLÜ</h2>
        <p style="font-size: 12px; color: #94a3b8; margin-bottom: 25px; font-family: 'Inter';">Sesleri ve oyun motorunu aktifleştirmek için sistemi başlatın.</p>
        <button id="systemStartBtn" aria-label="Sistemi Başlat" style="width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(90deg, #00ffa3, #00b894); color: #000; font-weight: 900; font-family: 'Orbitron'; font-size: 16px; cursor: pointer; text-transform: uppercase;">SİSTEMİ BAŞLAT</button>
    </div>
</div>

<header class="top-bar">
    <div class="brand">CRASH</div>
    <nav class="right-menu" aria-label="Üst Menü">
        <div class="user-pill-mini">
            <div class="balance-info">
                <b id="balance">0</b>
                <div class="mc-chip">MC</div>
            </div>
        </div>
        
        <div class="user-pill-mini" style="border-color: #ffcc00;">
            <div class="balance-info">
                <b id="betTotal" style="color:#ffcc00">0</b>
                <div class="mc-chip" style="background: radial-gradient(circle at 30% 30%, #ffcc00, #ff8a00); box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);">MC</div>
            </div>
        </div>
        <button class="back-btn" onclick="window.history.back()" aria-label="Geri Dön">GERİ</button>
    </nav>
</header>

<main>
    <div class="history" id="history" aria-label="Geçmiş Çarpanlar"></div>

    <div class="game-container">
        <canvas id="gameCanvas" aria-label="Crash Oyun Ekranı"></canvas>
        <div class="multiplier-display" aria-live="polite">
            <div class="status-text" id="statusText">SİSTEM HAZIRLANIR...</div>
            <div class="x-value" id="multiplier">1.00x</div>
        </div>
    </div>

    <div class="bottom-panel">
        <div class="bet-card">
            <input type="number" id="betInput1" value="100" aria-label="1. Bahis Miktarı">
            <div class="auto-row">
                <span>OTO</span>
                <label class="switch">
                    <input type="checkbox" id="autoSwitch1" aria-label="1. Otomatik Bahis">
                    <span class="slider"></span>
                </label>
            </div>
            <button id="btn1" class="main-btn btn-bet" aria-label="Birinci Bahsi Yap">MC KULLAN</button>
        </div>
        <div class="bet-card">
            <input type="number" id="betInput2" value="200" aria-label="2. Bahis Miktarı">
            <div class="auto-row">
                <span>OTO</span>
                <label class="switch">
                    <input type="checkbox" id="autoSwitch2" aria-label="2. Otomatik Bahis">
                    <span class="slider"></span>
                </label>
            </div>
            <button id="btn2" class="main-btn btn-bet" aria-label="İkinci Bahsi Yap">MC KULLAN</button>
        </div>
    </div>
</main>

<script type="module">

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
  authDomain:"emirhan-site.firebaseapp.com",
  projectId:"emirhan-site",
  storageBucket:"emirhan-site.firebasestorage.app",
  messagingSenderId:"668871888390",
  appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
let user=null;

const balanceEl=document.getElementById("balance");
const multEl=document.getElementById("multiplier");
const statusEl=document.getElementById("statusText");

const bet1Input=document.getElementById("betInput1");
const bet2Input=document.getElementById("betInput2");
const bet1Btn=document.getElementById("betBtn1");
const bet2Btn=document.getElementById("betBtn2");
const cash1Btn=document.getElementById("cashoutBtn1");
const cash2Btn=document.getElementById("cashoutBtn2");

const profit1=document.getElementById("profit1");
const profit2=document.getElementById("profit2");

let st=null;
let poll=null;
let busy=false;

function fmt(n){ return Number(n||0).toLocaleString('tr-TR'); }
async function token(){ return await user.getIdToken(); }
async function api(path, body){
  const t = await token();
  const r = await fetch(path,{method:"POST",headers:{'Content-Type':'application/json','Authorization':'Bearer '+t},body:JSON.stringify(body||{})});
  return await r.json();
}
async function apiGet(path){
  const t = await token();
  const r = await fetch(path,{headers:{'Authorization':'Bearer '+t}});
  return await r.json();
}

function setBusy(b){
  busy=b;
  [bet1Btn,bet2Btn,cash1Btn,cash2Btn].forEach(x=>x && (x.disabled=b));
}

function applyState(s){
  if(!s) return;
  if(s.ok===false){ statusEl.innerText=s.error||"Hata"; return; }
  st=s;
  balanceEl.innerText = fmt(s.balance||0);
  multEl.innerText = (Number(s.multiplier||1)).toFixed(2)+"x";
  statusEl.innerText = s.statusText || "";

  // slot 1
  const b1 = s.bets?.[0] || { state:"idle" };
  profit1.innerText = fmt(b1.payout||0);
  bet1Btn.style.display = (b1.state==="idle" && s.roundState!=="crashed") ? "block" : "none";
  cash1Btn.style.display = (b1.state==="active" && s.roundState==="running") ? "block" : "none";
  bet1Input.disabled = b1.state!=="idle" || s.roundState==="running";

  // slot 2
  const b2 = s.bets?.[1] || { state:"idle" };
  profit2.innerText = fmt(b2.payout||0);
  bet2Btn.style.display = (b2.state==="idle" && s.roundState!=="crashed") ? "block" : "none";
  cash2Btn.style.display = (b2.state==="active" && s.roundState==="running") ? "block" : "none";
  bet2Input.disabled = b2.state!=="idle" || s.roundState==="running";
}

bet1Btn.onclick = async ()=>{
  if(busy) return;
  const bet = parseInt(bet1Input.value,10);
  setBusy(true);
  const r = await api("/api/crash/bet",{ slot:1, bet });
  setBusy(false);
  applyState(r);
};
bet2Btn.onclick = async ()=>{
  if(busy) return;
  const bet = parseInt(bet2Input.value,10);
  setBusy(true);
  const r = await api("/api/crash/bet",{ slot:2, bet });
  setBusy(false);
  applyState(r);
};
cash1Btn.onclick = async ()=>{
  if(busy) return;
  setBusy(true);
  const r = await api("/api/crash/cashout",{ slot:1 });
  setBusy(false);
  applyState(r);
};
cash2Btn.onclick = async ()=>{
  if(busy) return;
  setBusy(true);
  const r = await api("/api/crash/cashout",{ slot:2 });
  setBusy(false);
  applyState(r);
};

async function tick(){
  try{
    const s = await apiGet("/api/crash/state");
    if(s?.ok) applyState(s);
  }catch{}
}

onAuthStateChanged(auth, async (u)=>{
  if(!u){ await signInAnonymously(auth); return; }
  user=u;
  const me = await apiGet("/api/me");
  if(me?.ok) balanceEl.innerText = fmt(me.balance||0);
  await tick();
  if(poll) clearInterval(poll);
  poll = setInterval(tick, 350);
});

</script>
</body>
</html>
