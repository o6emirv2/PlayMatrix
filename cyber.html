<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>PlayMatrix Cyber</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #00ffa3;
            --bg: #03050a;
            --glass: rgba(10, 15, 25, 0.9);
            --border: rgba(0, 255, 163, 0.2);
            --off: rgba(30, 41, 59, 0.7);
            /* Taşların boyutunu dinamik yapmak için CSS değişkeni ekledik */
            --tile-size: 65px; 
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background: var(--bg); 
            color: white; 
            font-family: 'Inter', sans-serif; 
            overflow: hidden; 
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- NÖRON AĞI ARKA PLANI --- */
        #neural-canvas {
            position: fixed;
            inset: 0;
            z-index: -1;
            background: radial-gradient(circle at center, #0a1520 0%, #03050a 100%);
        }

        /* --- ÜST BAR --- */
        .top-bar {
            height: 65px;
            min-height: 65px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background: var(--glass);
            backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border);
            z-index: 1000;
        }

        .brand { 
            font-family: 'Montserrat', sans-serif; 
            font-size: 14px; 
            font-weight: 900; 
            color: var(--primary); 
            text-shadow: 0 0 10px rgba(0, 255, 163, 0.5);
            white-space: nowrap;
        }
        
        .level-info { 
            font-weight: 800; 
            font-size: 12px; 
            background: rgba(0,255,163,0.1); 
            padding: 6px 12px; 
            border-radius: 12px; 
            border: 1px solid var(--border);
            white-space: nowrap;
        }

        .best-score-badge {
            color: var(--primary);
            opacity: 0.8;
            margin-left: 5px;
            padding-left: 5px;
            border-left: 1px solid var(--border);
        }

        .exit-btn {
            color: white;
            text-decoration: none;
            font-size: 11px;
            font-weight: 800;
            opacity: 0.6;
            padding: 8px;
            transition: 0.3s;
        }

        /* --- OYUN ALANI --- */
        #game-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 20px;
        }

        #grid {
            display: grid;
            gap: 8px; /* Boşlukları biraz kıstık ki büyük leveller sığsın */
            padding: 20px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 20px 50px rgba(0,0,0,0.4);
            transition: 0.5s;
        }

        .tile {
            width: var(--tile-size); 
            height: var(--tile-size);
            background: var(--off);
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            display: flex; align-items: center; justify-content: center;
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1), background 0.3s;
            border: 1px solid rgba(255,255,255,0.05);
        }

        .tile:active { transform: scale(0.9); }

        .line {
            position: absolute;
            background: #475569;
            border-radius: 4px;
            transition: all 0.4s;
        }

        /* Bağlantı Efekti */
        .tile.connected { background: rgba(0, 255, 163, 0.08); border-color: var(--border); }
        .tile.connected .line { background: var(--primary); box-shadow: 0 0 12px var(--primary); }

        /* --- MODALLAR --- */
        .overlay {
            position: absolute; inset: 0; background: rgba(3,5,10,0.85);
            display: flex; align-items: center; justify-content: center;
            z-index: 2000; backdrop-filter: blur(12px);
        }

        .modal {
            background: var(--glass); padding: 35px; border-radius: 28px;
            border: 1px solid var(--border); text-align: center; width: 85%; max-width: 340px;
        }

        .btn {
            width: 100%; padding: 16px; border-radius: 14px; border: none;
            background: var(--primary); color: #000; font-weight: 900;
            text-transform: uppercase; cursor: pointer; margin-top: 20px;
            font-size: 14px;
        }
        
        #win-status { font-size: 11px; letter-spacing: 2px; color: #fff; opacity: 0.5; margin-bottom: 5px; display: block; }
    </style>
</head>
<body>

    <canvas id="neural-canvas"></canvas>

    <div class="top-bar">
        <div class="brand"><i class="fa-solid fa-microchip"></i> CYBER_LINK</div>
        <div class="level-info">
            NODE: <span id="level-num">1</span>
            <span class="best-score-badge">EN İYİ: <span id="best-score">1</span></span>
        </div>
        <a href="index.html" class="exit-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i></a>
    </div>

    <div id="game-wrapper">
        <div id="grid"></div>

        <div id="win-overlay" class="overlay" style="display:none;">
            <div class="modal">
                <span id="win-status">[DURUM: BAŞARILI]</span>
                <h2 id="win-title" style="color:var(--primary); font-family: Montserrat;">SİSTEM SIZILDI</h2>
                <p id="win-desc" style="margin-top:10px; opacity:0.7; font-size: 14px;">Nöron bağlantıları başarıyla kuruldu.</p>
                <button class="btn" onclick="nextLevel()">SONRAKİ NODE</button>
            </div>
        </div>

        <div id="start-overlay" class="overlay">
            <div class="modal">
                <h2 style="color:var(--primary); font-family: Montserrat;">BAĞLANTIYI KUR</h2>
                <p style="margin-top:10px; opacity:0.7; font-size: 14px;">Zihnini odakla ve tüm devreleri merkeze bağla.</p>
                <button class="btn" onclick="initAudioAndStart()">SİSTEMİ AÇ</button>
            </div>
        </div>
    </div>

<script>
    // --- NÖRON ARKA PLAN ANİMASYONU ---
    const canvas = document.getElementById('neural-canvas');
    const ctx = canvas.getContext('2d');
    let particles = [];

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    class Particle {
        constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.vx = (Math.random() - 0.5) * 0.5;
            this.vy = (Math.random() - 0.5) * 0.5;
        }
        update() {
            this.x += this.vx; this.y += this.vy;
            if(this.x < 0 || this.x > canvas.width) this.vx *= -1;
            if(this.y < 0 || this.y > canvas.height) this.vy *= -1;
        }
    }

    for(let i=0; i<40; i++) particles.push(new Particle());

    function animateBG() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.fillStyle = 'rgba(0, 255, 163, 0.5)';
        ctx.strokeStyle = 'rgba(0, 255, 163, 0.1)';
        
        particles.forEach((p, i) => {
            p.update();
            ctx.beginPath();
            ctx.arc(p.x, p.y, 2, 0, Math.PI*2);
            ctx.fill();
            
            for(let j=i+1; j<particles.length; j++) {
                let p2 = particles[j];
                let dist = Math.hypot(p.x - p2.x, p.y - p2.y);
                if(dist < 150) {
                    ctx.beginPath();
                    ctx.moveTo(p.x, p.y);
                    ctx.lineTo(p2.x, p2.y);
                    ctx.stroke();
                }
            }
        });
        requestAnimationFrame(animateBG);
    }
    animateBG();

    // --- OYUN SESLERİ ---
    const sounds = {
        rotate: new Audio('https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3'),
        success: new Audio('https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'),
        start: new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3')
    };
    Object.values(sounds).forEach(s => s.volume = 0.3);

    function initAudioAndStart() {
        Object.values(sounds).forEach(s => { s.play(); s.pause(); });
        sounds.start.play();
        document.getElementById('start-overlay').style.display = 'none';
        
        loadBestScore();
        createLevel();
    }

    // --- DİNAMİK MESAJ SİSTEMİ (600+ Benzersiz Kombinasyon) ---
    const cyberTitles = [
        "SİSTEM SIZILDI", "GÜVENLİK AŞILDI", "AĞA ERİŞİLDİ", "VERİLER ÇEKİLDİ", 
        "FIREWALL ÇÖKTÜ", "ŞİFRELEME KIRILDI", "NODE AKTİF", "PROTOKOL TAMAM",
        "KÖK ERİŞİMİ", "SİBER AĞ ÇÖZÜLDÜ"
    ];
    
    const cyberDescs = [
        "Nöron bağlantıları başarıyla kuruldu.", "Ana sunucuya yetkisiz erişim sağlandı.",
        "Kriptografik anahtar başarıyla çözüldü.", "Güvenlik duvarı atlatıldı, sistem senin.",
        "Siber ağ protokolleri güncellendi.", "Karanlık ağ geçidi açıldı.",
        "Veri paketleri hedefe yönlendirildi.", "Hedef sistemin kontrolü sağlandı.",
        "Biyometrik kilitler devre dışı bırakıldı.", "Matris kodları deşifre edildi.",
        "Güvenlik kameraları döngüye alındı.", "İz bırakmadan ana belleğe sızıldı.",
        "Admin yetkileri ele geçirildi.", "Kuantum şifrelemesi bypass edildi.",
        "Sistem logları başarıyla temizlendi."
    ];

    const cyberStatuses = ["[DURUM: BAŞARILI]", "[DURUM: GİZLİ]", "[DURUM: KRİTİK]", "[DURUM: STABİL]"];

    function generateWinMessage(lvl) {
        // Bölüm numarasına göre farklı kelimeler seçmek için matematiksel indeksleme kullanıyoruz
        const titleIndex = (lvl * 3) % cyberTitles.length;
        const descIndex = (lvl * 7) % cyberDescs.length;
        const statusIndex = (lvl * 2) % cyberStatuses.length;

        document.getElementById('win-status').innerText = cyberStatuses[statusIndex];
        document.getElementById('win-title').innerText = `${cyberTitles[titleIndex]} [LVL ${lvl}]`;
        document.getElementById('win-desc').innerText = cyberDescs[descIndex];
    }

    // --- OYUN MANTIĞI VE SKOR SİSTEMİ ---
    let level = 1;
    let bestLevel = 1;
    let gridSize = 3; // Başlangıç 3x3
    let tiles = [];
    let isGameLocked = false;

    function loadBestScore() {
        const savedScore = localStorage.getItem('cyberLinkBestScore');
        if(savedScore) bestLevel = parseInt(savedScore);
        document.getElementById('best-score').innerText = bestLevel;
    }

    function saveBestScore() {
        if(level > bestLevel) {
            bestLevel = level;
            localStorage.setItem('cyberLinkBestScore', bestLevel);
            document.getElementById('best-score').innerText = bestLevel;
        }
    }

    // Taş boyutunu ekrana sığacak şekilde dinamik hesapla
    function calculateTileSize() {
        const maxWidth = window.innerWidth > 450 ? 400 : window.innerWidth * 0.85;
        const gapSize = 8; // Grid gap
        const totalGap = (gridSize - 1) * gapSize;
        
        let newSize = Math.floor((maxWidth - totalGap) / gridSize);
        if (newSize > 65) newSize = 65; // Maksimum boyut
        if (newSize < 30) newSize = 30; // Minimum boyut
        
        document.documentElement.style.setProperty('--tile-size', `${newSize}px`);
    }

    function createLevel() {
        const grid = document.getElementById('grid');
        grid.innerHTML = '';
        grid.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;
        
        calculateTileSize(); // Izgara boyutuna göre taşları ayarla

        tiles = [];
        isGameLocked = false;

        for (let i = 0; i < gridSize * gridSize; i++) {
            const tileDiv = document.createElement('div');
            tileDiv.className = 'tile';
            
            const type = Math.floor(Math.random() * 2); 
            const targetRotation = 0; 
            
            const scrambleTurns = Math.floor(Math.random() * 3) + 1;
            const currentRotation = scrambleTurns * 90;
            
            tileDiv.style.transform = `rotate(${currentRotation}deg)`;
            tileDiv.innerHTML = renderLines(type);
            tileDiv.onclick = () => rotateTile(i);
            
            grid.appendChild(tileDiv);
            
            tiles.push({ 
                type: type, currentRotation: currentRotation, 
                targetRotation: targetRotation, element: tileDiv 
            });
        }
        
        checkConnectionsAndWin();
    }

    function renderLines(type) {
        if(type === 0) return `<div class="line" style="width:100%; height:4px;"></div>`;
        return `<div class="line" style="width:55%; height:4px; right:0; top:50%; transform:translateY(-50%);"></div>
                <div class="line" style="width:4px; height:55%; left:50%; bottom:0; transform:translateX(-50%);"></div>`;
    }

    function rotateTile(index) {
        if(isGameLocked) return;

        sounds.rotate.currentTime = 0; 
        sounds.rotate.play();
        
        tiles[index].currentRotation = (tiles[index].currentRotation + 90) % 360;
        tiles[index].element.style.transform = `rotate(${tiles[index].currentRotation}deg)`;
        
        checkConnectionsAndWin();
    }

    function checkConnectionsAndWin() {
        let correctTilesCount = 0;

        tiles.forEach(t => {
            let isCorrect = false;

            if (t.type === 0) {
                if (t.currentRotation === 0 || t.currentRotation === 180) isCorrect = true;
            } else if (t.type === 1) {
                if (t.currentRotation === t.targetRotation) isCorrect = true;
            }

            if (isCorrect) {
                t.element.classList.add('connected');
                correctTilesCount++;
            } else {
                t.element.classList.remove('connected');
            }
        });

        if (correctTilesCount === tiles.length) {
            isGameLocked = true;
            saveBestScore();
            
            // Kazanma mesajını bölüm numarasına göre dinamik oluştur
            generateWinMessage(level);

            setTimeout(() => {
                sounds.success.play();
                document.getElementById('win-overlay').style.display = 'flex';
            }, 300);
        }
    }

    function nextLevel() {
        level++;
        document.getElementById('level-num').innerText = level;
        
        // ZORLUK ARTIŞI: Her 5 bölümde bir ızgara boyutunu (gridSize) artır.
        if((level - 1) % 5 === 0 && gridSize < 10) {
            gridSize++; 
        }
        
        document.getElementById('win-overlay').style.display = 'none';
        createLevel();
    }
</script>
</body>
</html>
