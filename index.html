<!DOCTYPE html>
<html lang="tr" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>PlayMatrix | Ultra Gaming Experience</title>

    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;700;800&family=Orbitron:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            /* Dark Mode (Varsayƒ±lan) */
            --bg-body: #05070a;
            --bg-card: rgba(15, 18, 26, 0.8);
            --bg-topbar: rgba(10, 12, 18, 0.85);
            --primary: #00d2ff;
            --primary-glow: rgba(0, 210, 255, 0.4);
            --accent: #7000ff;
            --text-main: #ffffff;
            --text-dim: #94a3b8;
            --border: rgba(255, 255, 255, 0.08);
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
            --success: #00ffa3;
            --danger: #ff4d4d;
            --glass-blur: blur(15px);
        }

        [data-theme="light"] {
            --bg-body: #f0f2f5;
            --bg-card: rgba(255, 255, 255, 0.9);
            --bg-topbar: rgba(255, 255, 255, 0.9);
            --primary: #007bff;
            --primary-glow: rgba(0, 123, 255, 0.2);
            --accent: #6610f2;
            --text-main: #1e293b;
            --text-dim: #64748b;
            --border: rgba(0, 0, 0, 0.08);
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        * { margin:0; padding:0; box-sizing:border-box; -webkit-tap-highlight-color:transparent; font-family: 'Plus Jakarta Sans', sans-serif; transition: background 0.3s, color 0.3s; }
        
        body { background: var(--bg-body); color: var(--text-main); overflow-x: hidden; }

        #snow { position:fixed; top:0; left:0; width:100%; height:100%; z-index:1; pointer-events:none; opacity: 0.4; }

        /* --- √úST BAR (REWORKED) --- */
        .top-bar {
            position: fixed; top: 0; width: 100%; height: 70px;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 5%; background: var(--bg-topbar);
            backdrop-filter: var(--glass-blur); border-bottom: 1px solid var(--border); z-index: 2000;
        }

        .brand {
            font-family: 'Orbitron', sans-serif; font-size: 22px; font-weight: 900; 
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            letter-spacing: 1px;
        }

        .right-menu { display: flex; gap: 12px; align-items: center; }

        /* --- TEMA DEƒûƒ∞≈ûTƒ∞Rƒ∞Cƒ∞ --- */
        .theme-toggle {
            width: 40px; height: 40px; border-radius: 12px; background: var(--border);
            display: flex; align-items: center; justify-content: center; cursor: pointer; border: none; color: var(--text-main);
        }

        .user-pill { display: none; align-items: center; gap: 12px; background: var(--border); padding: 5px 5px 5px 15px; border-radius: 16px; border: 1px solid var(--border); cursor: pointer; position: relative; }
        .balance-info b { font-family: 'Orbitron', sans-serif; color: var(--success); font-size: 14px; }

        .mc-chip {
            width: 26px; height: 26px; background: linear-gradient(135deg, var(--primary), var(--accent));
            border-radius: 50%; margin-left: 8px; display: flex; align-items: center; justify-content: center;
            font-size: 8px; font-weight: 900; color: #fff; box-shadow: 0 0 10px var(--primary-glow);
        }

        .avatar { width: 36px; height: 36px; border-radius: 10px; overflow: hidden; border: 2px solid var(--primary); }
        .avatar img { width: 100%; height: 100%; object-fit: cover; }

        /* --- KARTLAR (3D & PROFESYONEL) --- */
        .section-title {
            padding: 40px 10% 20px; font-size: 14px; font-weight: 800;
            text-transform: uppercase; letter-spacing: 3px; color: var(--primary);
            display: flex; align-items: center; gap: 15px;
        }
        .section-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--border), transparent); }

        .games-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); 
            gap: 20px; padding: 0 10% 40px;
        }

        .game-card {
            background: var(--bg-card); border-radius: 24px; padding: 35px 20px;
            text-align: center; border: 1px solid var(--border); position: relative;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); overflow: hidden;
            backdrop-filter: blur(10px);
        }
        .game-card:hover { transform: translateY(-10px); border-color: var(--primary); box-shadow: 0 20px 40px rgba(0,0,0,0.4); }
        
        /* 3D Ikon Efekti */
        .game-icon { 
            font-size: 50px; margin-bottom: 20px; display: inline-block; 
            filter: drop-shadow(0 10px 15px rgba(0,0,0,0.3));
            transition: 0.3s;
        }
        .game-card:hover .game-icon { transform: scale(1.1) rotate(5deg); }

        .game-card span { font-weight: 700; font-size: 17px; display: block; margin-bottom: 10px; }

        /* --- DUYURU BARI --- */
        .announcement-bar {
            position: fixed; top: 70px; width: 100%; height: 35px;
            background: var(--accent); color: white;
            z-index: 1999; display: flex; align-items: center; overflow: hidden; font-weight: 700;
        }

        /* --- MODAL TASARIMI (ULTRA) --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(20px);
            display: none; align-items: center; justify-content: center; z-index: 5000;
            animation: fadeIn 0.3s ease;
        }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .modal-card { 
            width: 90%; max-width: 480px; padding: 35px; border-radius: 30px; 
            background: var(--bg-card); border: 1px solid var(--border); 
            text-align: center; position: relative; box-shadow: var(--shadow);
        }

        .modal-card input { 
            width: 100%; padding: 15px; margin-bottom: 15px; border-radius: 15px; 
            background: rgba(0,0,0,0.2); border: 1px solid var(--border); color: var(--text-main); 
            font-size: 14px; outline: none; transition: 0.3s;
        }
        .modal-card input:focus { border-color: var(--primary); background: rgba(0,0,0,0.4); }

        .modal-btn { 
            width: 100%; padding: 16px; border-radius: 15px; border: none; 
            background: linear-gradient(90deg, var(--primary), var(--accent)); 
            color: #fff; font-weight: 800; cursor: pointer; text-transform: uppercase;
            letter-spacing: 1px; transition: 0.3s;
        }
        .modal-btn:hover { opacity: 0.9; transform: scale(1.02); }

        /* --- FOOTER & SOSYAL --- */
        .footer { background: var(--bg-topbar); padding: 60px 20px; border-top: 1px solid var(--border); text-align: center; }
        .social-btn {
            width: 45px; height: 45px; background: var(--border); border-radius: 14px;
            display: inline-flex; align-items: center; justify-content: center; margin: 0 8px;
            color: var(--text-main); font-size: 20px; transition: 0.3s; text-decoration: none;
        }
        .social-btn:hover { background: var(--primary); color: #fff; transform: translateY(-5px); }

        /* --- √áARK --- */
        .wheel-container { position: relative; width: 280px; height: 280px; margin: 25px auto; }
        #wheelCanvas { border-radius: 50%; border: 8px solid var(--border); }
        
        .badge { font-size: 10px; padding: 5px 12px; border-radius: 8px; font-weight: 800; }
        .badge-free { background: rgba(0, 255, 163, 0.1); color: var(--success); }
        .badge-danger { background: rgba(255, 77, 77, 0.1); color: var(--danger); }
        .badge-success { background: rgba(0, 255, 163, 0.1); color: var(--success); }

        /* Search Bar */
        #searchInput {
            width: 100%; max-width: 600px; padding: 18px 30px; border-radius: 20px;
            background: var(--bg-card); border: 1px solid var(--border); color: var(--text-main);
            backdrop-filter: var(--glass-blur); font-size: 16px; margin-bottom: 20px;
        }

        @media(max-width: 768px) {
            .games-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 0 15px; }
            .section-title { padding: 30px 15px 15px; }
            .brand { font-size: 18px; }
        }
    </style>
</head>
<body>

<canvas id="snow"></canvas>

<div class="top-bar">
    <div class="brand">PLAYMATRIX</div>
    
    <div class="right-menu">
        <button class="theme-toggle" id="themeToggle"><i class="fa-solid fa-moon"></i></button>
        
        <button class="modal-btn" id="loginBtn" style="width:auto; padding: 10px 20px; font-size: 12px;">Gƒ∞Rƒ∞≈û</button>
        <button class="modal-btn" id="regBtn" style="width:auto; padding: 10px 20px; font-size: 12px; background: var(--border);">KAYIT</button>

        <div class="user-pill" id="userPill">
            <div class="balance-info">
                <b id="userBalance">0</b>
                <div class="mc-chip">MC</div>
            </div>
            <div class="avatar" id="avatarTrigger">
                <img src="" id="userProfileImg">
            </div>
            <div class="dropdown" id="userDropdown" style="position: absolute; top: 60px; right: 0; background: var(--bg-card); border: 1px solid var(--border); border-radius: 15px; display: none; flex-direction: column; width: 200px; padding: 10px; backdrop-filter: blur(10px);">
                <div style="padding: 10px; cursor: pointer;" onclick="openModal('profileModal')"><i class="fa-solid fa-user-gear"></i> Profil</div>
                <div style="padding: 10px; cursor: pointer;" onclick="openModal('wheelModal')"><i class="fa-solid fa-dharmachakra"></i> √áark</div>
                <div style="padding: 10px; cursor: pointer;" onclick="openModal('bonusModal')"><i class="fa-solid fa-gift"></i> Bonus</div>
                <div id="logoutBtn" style="padding: 10px; cursor: pointer; color: var(--danger); border-top: 1px solid var(--border);"><i class="fa-solid fa-power-off"></i> √áƒ±kƒ±≈ü</div>
            </div>
        </div>
    </div>
</div>

<div class="announcement-bar">
    <div style="white-space: nowrap; animation: marquee 20s linear infinite;">
        &nbsp;&nbsp;&nbsp; üöÄ PLAYMATRIX 2026: YENƒ∞ NESƒ∞L OYUN DENEYƒ∞Mƒ∞NE HO≈û GELDƒ∞Nƒ∞Z! ‚Ä¢ G√úNL√úK √áARKINIZI √áEVƒ∞REREK BEDAVA MC KAZANIN! ‚Ä¢ YENƒ∞ MULTIPLAYER MODLARI AKTƒ∞F EDƒ∞LDƒ∞!
    </div>
</div>

<main style="margin-top: 150px;">
    <div style="text-align: center; padding: 0 20px;">
        <input type="text" id="searchInput" placeholder="Oyun d√ºnyasƒ±nda ke≈üfe √ßƒ±k...">
    </div>

    <div class="section-title">Multiplayer Arenasƒ±</div>
    <div class="games-grid">
        <div class="game-card" data-name="Online Pi≈üti" onclick="checkLogin('OnlinePi≈üti.html')">
            <div class="game-icon">üÉè</div>
            <span>Online Pi≈üti</span>
            <div class="badge auth-badge badge-danger">Gƒ∞Rƒ∞≈û GEREKƒ∞R</div>
        </div>
        <div class="game-card" data-name="Online Grid Conquest" onclick="checkLogin('GridConquest.html')">
            <div class="game-icon">‚öîÔ∏è</div>
            <span>Grid Conquest</span>
            <div class="badge auth-badge badge-danger">Gƒ∞Rƒ∞≈û GEREKƒ∞R</div>
        </div>
    </div>

    <div class="section-title">Zeka & Strateji</div>
    <div class="games-grid">
        <div class="game-card" data-name="Cyber" onclick="location.href='Cyber.html'">
            <div class="game-icon">üß†</div>
            <span>Cyber Pulse</span>
            <div class="badge badge-free">√úCRETSƒ∞Z</div>
        </div>
        <div class="game-card" data-name="Pattern Master" onclick="location.href='PatternMaster.html'">
            <div class="game-icon">üß©</div>
            <span>Pattern Master</span>
            <div class="badge badge-free">√úCRETSƒ∞Z</div>
        </div>
    </div>

    <div class="section-title">Premium Deneyim</div>
    <div class="games-grid">
        <div class="game-card" data-name="Crash" onclick="checkLogin('Crash.html')">
            <div class="game-icon">üöÄ</div>
            <span>Matrix Crash</span>
            <div class="badge auth-badge badge-danger">PREMIUM</div>
        </div>
        <div class="game-card" data-name="Mines" onclick="checkLogin('Mines.html')">
            <div class="game-icon">üí£</div>
            <span>Deep Mines</span>
            <div class="badge auth-badge badge-danger">PREMIUM</div>
        </div>
        <div class="game-card" data-name="BlackJack" onclick="checkLogin('BlackJack.html')">
            <div class="game-icon">‚ô†Ô∏è</div>
            <span>Elite BlackJack</span>
            <div class="badge auth-badge badge-danger">PREMIUM</div>
        </div>
        <div class="game-card" data-name="Pi≈üti" onclick="checkLogin('Pi≈üti.html')">
            <div class="game-icon">üé¥</div>
            <span>Classic Pi≈üti</span>
            <div class="badge auth-badge badge-danger">PREMIUM</div>
        </div>    
    </div>

    <div class="section-title">Hƒ±zlƒ± Oyunlar</div>
    <div class="games-grid">
        <div class="game-card" data-name="Space Pro" onclick="location.href='SpacePro.html'">
            <div class="game-icon">üë®‚ÄçüöÄ</div>
            <span>Space Odyssey</span>
            <div class="badge badge-free">FREE</div>
        </div>
        <div class="game-card" data-name="Snake Pro" onclick="location.href='SnakePro.html'">
            <div class="game-icon">üêç</div>
            <span>Neon Snake</span>
            <div class="badge badge-free">FREE</div>
        </div>
        <div class="game-card" data-name="Tower Stack" onclick="location.href='TowerStack.html'">
            <div class="game-icon">üè¢</div>
            <span>Tower Build</span>
            <div class="badge badge-free">FREE</div>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="brand" style="margin-bottom: 20px;">PLAYMATRIX</div>
    <div class="social-icons">
        <a href="https://t.me/+25bJu1XJssZhYjg8" class="social-btn"><i class="fa-brands fa-discord"></i></a>
        <a href="https://www.instagram.com/pixel_arena_games" class="social-btn"><i class="fa-brands fa-instagram"></i></a>
        <a href="https://t.me/+25bJu1XJssZhYjg8" class="social-btn"><i class="fa-brands fa-telegram"></i></a>
    </div>
    <p style="color:var(--text-dim); font-size:12px; margin-top: 30px; opacity: 0.6;">¬© 2026 PlayMatrix Global Ecosystem. All rights reserved.</p>
</footer>

<div class="modal-overlay" id="alertModal">
    <div class="modal-card">
        <div id="alertIcon" style="font-size: 50px; margin-bottom: 20px;"></div>
        <h2 id="alertTitle">Sistem Bildirimi</h2>
        <p id="alertBody" style="color: var(--text-dim); margin-bottom: 25px;"></p>
        <button class="modal-btn" onclick="closeModal('alertModal')">ANLADIM</button>
    </div>
</div>

<div class="modal-overlay" id="authOverlay">
    <div class="modal-card">
        <h2 id="authTitle" style="margin-bottom: 20px; font-family: 'Orbitron';">Giri≈ü Yap</h2>
        <input type="text" id="authEmail" placeholder="E-posta veya Kullanƒ±cƒ± Adƒ±">
        <input type="password" id="authPassword" placeholder="≈ûifre">
        <input type="email" id="regEmail" placeholder="E-posta" style="display:none;">
        <input type="text" id="authUsername" placeholder="Kullanƒ±cƒ± Adƒ±" style="display:none;">
        <div id="authErrorMsg" style="color: var(--danger); font-size: 12px; margin-bottom: 10px;"></div>
        <button class="modal-btn" id="authSubmit">Sƒ∞STEME Gƒ∞Rƒ∞≈û YAP</button>
        <p id="switchMode" style="margin-top:20px; font-size:13px; cursor:pointer; color: var(--text-dim);">Hesabƒ±n yok mu? <b style="color:var(--primary)">Kayƒ±t Ol</b></p>
        <p onclick="closeModal('authOverlay')" style="margin-top:15px; cursor:pointer; opacity:0.5;">Kapat</p>
    </div>
</div>

<div class="modal-overlay" id="profileModal">
    <div class="modal-card">
        <h2 style="margin-bottom: 20px;">Profil Merkezi</h2>
        <div style="text-align:left;">
            <input type="text" id="profEmail" disabled style="opacity: 0.6;">
            <input type="text" id="profNameSurname" placeholder="Ad Soyad">
            <input type="text" id="profPhone" placeholder="Telefon">
            <input type="text" id="profUser" placeholder="Kullanƒ±cƒ± Adƒ±">
        </div>
        <div style="margin: 15px 0; font-size: 11px; color: var(--primary);">AVATARINI √ñZELLE≈ûTƒ∞R</div>
        <div id="avatarLibrary" style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin-bottom: 20px; max-height: 150px; overflow-y: auto; padding: 5px;"></div>
        <button class="modal-btn" onclick="updateProfile()">G√úNCELLE</button>
        <p onclick="closeModal('profileModal')" style="margin-top:15px; cursor:pointer; opacity:0.5;">ƒ∞ptal</p>
    </div>
</div>

<div class="modal-overlay" id="wheelModal">
    <div class="modal-card">
        <h2 style="font-family: 'Orbitron';">≈ûans √áarkƒ±</h2>
        <div class="wheel-container">
            <div style="position: absolute; top: -15px; left: 50%; transform: translateX(-50%); width: 20px; height: 30px; background: var(--primary); clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 10;"></div>
            <canvas id="wheelCanvas" width="500" height="500" style="width: 100%; height: 100%;"></canvas>
        </div>
        <div id="wheelResultText" style="height: 30px; font-weight: 800; color: var(--success);"></div>
        <button class="modal-btn" id="spinBtn" onclick="spinWheel()">√áEVƒ∞R VE KAZAN</button>
        <div id="wheelTimer" style="margin-top: 10px; font-size: 12px; color: var(--accent);"></div>
        <p onclick="closeModal('wheelModal')" style="margin-top:15px; cursor:pointer; opacity:0.5;">Kapat</p>
    </div>
</div>

<div class="modal-overlay" id="bonusModal">
    <div class="modal-card">
        <h2 style="margin-bottom: 20px;">Promosyon Kod</h2>
        <input type="text" id="bonusInput" placeholder="KODU BURAYA YAZIN" style="text-align: center; font-weight: 900; letter-spacing: 3px;">
        <div id="promoFeedback" style="margin-bottom: 15px; font-size: 12px;"></div>
        <button class="modal-btn" onclick="claimBonus()">KODU KULLAN</button>
        <p onclick="closeModal('bonusModal')" style="margin-top:15px; cursor:pointer; opacity:0.5;">ƒ∞ptal</p>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut, signInWithEmailAndPassword, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, setDoc, updateDoc, getDoc, increment, collection, query, where, getDocs } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain:"emirhan-site.firebaseapp.com",
    projectId:"emirhan-site",
    storageBucket:"emirhan-site.firebasestorage.app",
    messagingSenderId:"668871888390",
    appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- KARANLIK/A√áIK MOD ---
const themeToggle = document.getElementById('themeToggle');
themeToggle.onclick = () => {
    const current = document.documentElement.getAttribute('data-theme');
    const target = current === 'dark' ? 'light' : 'dark';
    document.documentElement.setAttribute('data-theme', target);
    themeToggle.innerHTML = target === 'dark' ? '<i class="fa-solid fa-moon"></i>' : '<i class="fa-solid fa-sun"></i>';
};

// --- MODAL Y√ñNETƒ∞Mƒ∞ ---
window.openModal = (id) => { 
    document.getElementById(id).style.display = 'flex'; 
    if(id === 'wheelModal') drawWheel();
};
window.closeModal = (id) => { document.getElementById(id).style.display = 'none'; };

// Alert Modal Adaptasyonu
window.showMatrixModal = (title, message, type = 'info') => {
    const icon = document.getElementById("alertIcon");
    document.getElementById("alertTitle").innerText = title;
    document.getElementById("alertBody").innerText = message;
    icon.innerHTML = type === 'error' ? '‚ö†Ô∏è' : type === 'success' ? '‚úÖ' : '‚ÑπÔ∏è';
    openModal('alertModal');
};

// --- √áARK Sƒ∞STEMƒ∞ ---
const rewards = [
    { label: "2.500", val: 2500, color: "#0f172a" },
    { label: "5.000", val: 5000, color: "#1e293b" },
    { label: "7.500", val: 7500, color: "#0f172a" },
    { label: "12.500", val: 12500, color: "#1e293b" },
    { label: "20.000", val: 20000, color: "#0f172a" },
    { label: "25.000", val: 25000, color: "#1e293b" },
    { label: "30.000", val: 30000, color: "#0f172a" },
    { label: "50.000", val: 50000, color: "#7000ff" }
];

function drawWheel() {
    const canvas = document.getElementById("wheelCanvas");
    const ctx = canvas.getContext("2d");
    const centerX = 250, centerY = 250, radius = 240;
    const slice = (2 * Math.PI) / rewards.length;
    ctx.clearRect(0,0,500,500);
    rewards.forEach((r, i) => {
        const angle = i * slice - Math.PI/2;
        ctx.beginPath(); ctx.fillStyle = r.color; ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, angle, angle + slice); ctx.fill();
        ctx.save(); ctx.translate(centerX, centerY); ctx.rotate(angle + slice/2);
        ctx.textAlign = "right"; ctx.fillStyle = "#fff"; ctx.font = "bold 28px Orbitron";
        ctx.fillText(r.label, radius - 20, 10); ctx.restore();
    });
}

let wheelRot = 0;
window.spinWheel = async () => {
    const userRef = doc(db, "users", auth.currentUser.uid);
    const userDoc = await getDoc(userRef);
    if (Date.now() - (userDoc.data().lastSpin || 0) < 86400000) {
        showMatrixModal("Limit", "G√ºnde 1 kez √ßevirebilirsiniz.", "error"); return;
    }
    const idx = Math.floor(Math.random() * rewards.length);
    const stopAt = 3600 + (360 - (idx * (360/rewards.length)));
    wheelRot += stopAt;
    document.getElementById("wheelCanvas").style.transition = "transform 5s cubic-bezier(0.15, 0, 0.15, 1)";
    document.getElementById("wheelCanvas").style.transform = `rotate(${wheelRot}deg)`;
    document.getElementById("spinBtn").disabled = true;
    setTimeout(async () => {
        await updateDoc(userRef, { balance: increment(rewards[idx].val), lastSpin: Date.now() });
        document.getElementById("wheelResultText").innerText = `KAZANDIN: ${rewards[idx].label} MC!`;
        checkWheelCooldown();
    }, 5000);
};

// --- AUTH & USER ---
onAuthStateChanged(auth, user => {
    const badges = document.querySelectorAll(".auth-badge");
    if(user) {
        document.getElementById("loginBtn").style.display="none";
        document.getElementById("regBtn").style.display="none";
        document.getElementById("userPill").style.display="flex";
        badges.forEach(b => { b.innerText = "OYNA"; b.className = "badge auth-badge badge-success"; });
        onSnapshot(doc(db, "users", user.uid), s => {
            if(s.exists()){
                const d = s.data();
                document.getElementById("userBalance").innerText = d.balance.toLocaleString();
                document.getElementById("userProfileImg").src = d.avatar || "";
                loadAvatars(d.avatar);
                // Profil verilerini doldur
                document.getElementById("profEmail").value = user.email;
                document.getElementById("profNameSurname").value = d.fullName || "";
                document.getElementById("profPhone").value = d.phone || "";
                document.getElementById("profUser").value = d.username || "";
            }
        });
    } else {
        document.getElementById("loginBtn").style.display="block";
        document.getElementById("regBtn").style.display="block";
        document.getElementById("userPill").style.display="none";
        badges.forEach(b => { b.innerText = "Gƒ∞Rƒ∞≈û GEREKƒ∞R"; b.className = "badge auth-badge badge-danger"; });
    }
});

// --- BONUS Sƒ∞STEMƒ∞ ---
window.claimBonus = async () => {
    const code = document.getElementById("bonusInput").value.trim().toUpperCase();
    const fb = document.getElementById("promoFeedback");
    if(!code) return;
    fb.innerText = "ƒ∞≈üleniyor...";
    const q = query(collection(db, "promocodes"), where("code", "==", code));
    const snap = await getDocs(q);
    if(snap.empty) { fb.innerText = "Ge√ßersiz Kod!"; fb.style.color = "var(--danger)"; return; }
    
    const userRef = doc(db, "users", auth.currentUser.uid);
    const userSnap = await getDoc(userRef);
    if(userSnap.data().usedPromos?.includes(code)) { fb.innerText = "Zaten Kullanƒ±ldƒ±!"; return; }
    
    await updateDoc(userRef, { 
        balance: increment(snap.docs[0].data().amount),
        usedPromos: [...(userSnap.data().usedPromos || []), code]
    });
    fb.innerText = "Ba≈üarƒ±lƒ±!"; fb.style.color = "var(--success)";
};

// --- Dƒ∞ƒûER FONKSƒ∞YONLAR ---
window.checkLogin = (url) => { if(!auth.currentUser) openModal('authOverlay'); else location.href = url; };
document.getElementById("avatarTrigger").onclick = (e) => { e.stopPropagation(); document.getElementById("userDropdown").style.display = document.getElementById("userDropdown").style.display === 'flex' ? 'none' : 'flex'; };
window.onclick = () => document.getElementById("userDropdown").style.display = 'none';
document.getElementById("logoutBtn").onclick = () => signOut(auth);

// Arama
document.getElementById('searchInput').oninput = (e) => {
    const term = e.target.value.toLowerCase();
    document.querySelectorAll('.game-card').forEach(c => {
        c.style.display = c.getAttribute('data-name').toLowerCase().includes(term) ? 'block' : 'none';
    });
};

// Snow Effect
const canvasS = document.getElementById("snow"); const ctxS = canvasS.getContext("2d");
let pS = [];
function resS() { canvasS.width = window.innerWidth; canvasS.height = window.innerHeight; }
window.onresize = resS; resS();
for(let i=0;i<80;i++) pS.push({x:Math.random()*canvasS.width, y:Math.random()*canvasS.height, r:Math.random()*2+1, d:Math.random()*1});
function drawS(){
    ctxS.clearRect(0,0,canvasS.width,canvasS.height); ctxS.fillStyle = "rgba(255,255,255,0.3)";
    pS.forEach(p => { ctxS.beginPath(); ctxS.arc(p.x,p.y,p.r,0,Math.PI*2); ctxS.fill(); p.y+=p.d; if(p.y>canvasS.height) p.y=-10; });
    requestAnimationFrame(drawS);
}
drawS();

// Avatar Library (Dinamik)
const avatarLinks = ["https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRQwyXlGFYmEebbJwy3udOoiY1aHks5DHDL-LjNe-O2rw&s=10", "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQujzeT1nbxD37pbAAGFoEQYZfH7nHKNHebtVxjQZo1vA&s=10", "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyFK0ZyigAzwNoA3Ku85fCYQ0jjn9pD4bXb3udeMJoQQ&s=10"];
function loadAvatars(curr){
    const lib = document.getElementById("avatarLibrary"); lib.innerHTML = "";
    avatarLinks.forEach(l => {
        const img = document.createElement("img"); img.src = l;
        img.style = `width:100%; aspect-ratio:1; border-radius:10px; cursor:pointer; border:2px solid ${l===curr?'var(--primary)':'transparent'}`;
        img.onclick = () => updateDoc(doc(db,"users",auth.currentUser.uid), {avatar: l});
        lib.appendChild(img);
    });
}

// Auth ƒ∞≈ülemleri
let isLogin = true;
document.getElementById("loginBtn").onclick = () => { isLogin=true; updateAuthUI(); openModal('authOverlay'); };
document.getElementById("regBtn").onclick = () => { isLogin=false; updateAuthUI(); openModal('authOverlay'); };
document.getElementById("switchMode").onclick = () => { isLogin = !isLogin; updateAuthUI(); };

function updateAuthUI(){
    document.getElementById("authTitle").innerText = isLogin ? "Giri≈ü Yap" : "Kayƒ±t Ol";
    document.getElementById("regEmail").style.display = isLogin ? "none" : "block";
    document.getElementById("authUsername").style.display = isLogin ? "none" : "block";
    document.getElementById("authEmail").style.display = isLogin ? "block" : "none";
}

document.getElementById("authSubmit").onclick = async () => {
    const emailInput = document.getElementById("authEmail").value;
    const pass = document.getElementById("authPassword").value;
    try {
        if(isLogin) {
            await signInWithEmailAndPassword(auth, emailInput, pass);
            closeModal('authOverlay');
        } else {
            const email = document.getElementById("regEmail").value;
            const userN = document.getElementById("authUsername").value;
            const res = await createUserWithEmailAndPassword(auth, email, pass);
            await setDoc(doc(db, "users", res.user.uid), { username: userN, email, balance: 50000, lastSpin: 0, avatar: avatarLinks[0] });
            closeModal('authOverlay');
        }
    } catch(e) { document.getElementById("authErrorMsg").innerText = e.message; }
};

async function checkWheelCooldown() {
    const userDoc = await getDoc(doc(db, "users", auth.currentUser.uid));
    const diff = 86400000 - (Date.now() - (userDoc.data().lastSpin || 0));
    const btn = document.getElementById("spinBtn");
    if(diff > 0) {
        btn.disabled = true;
        document.getElementById("wheelTimer").innerText = "Sƒ±radaki hak 24 saat sonra.";
    } else {
        btn.disabled = false;
        document.getElementById("wheelTimer").innerText = "√áevirmeye Hazƒ±r!";
    }
}
</script>
</body>
</html>
