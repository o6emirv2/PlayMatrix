<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

<title>PlayMatrix | Ãœcretsiz Online Multiplayer, Zeka ve Casino OyunlarÄ±</title>
<meta name="description" content="PlayMatrix: TÃ¼rkiye'nin en iyi Ã¼cretsiz online multiplayer arena, zeka ve strateji oyunlarÄ± platformu. KayÄ±t ol, ÅŸans Ã§arkÄ±nÄ± Ã§evir, anÄ±nda MC kazan ve oynamaya baÅŸla!">
<meta name="keywords" content="online oyunlar, Ã¼cretsiz oyun oyna, multiplayer oyunlar, online piÅŸti, zeka oyunlarÄ±, casino oyunlarÄ±, tarayÄ±cÄ± oyunlarÄ±, PlayMatrix">
<meta name="author" content="PlayMatrix Global">
<meta name="robots" content="index, follow">
<meta name="language" content="Turkish">
<meta name="theme-color" content="#04060b">
<link rel="canonical" href="https://www.senindomainin.com/">

<meta property="og:title" content="PlayMatrix | Ãœcretsiz Online Multiplayer ve Zeka OyunlarÄ±">
<meta property="og:description" content="KayÄ±t ol, Ã§arkÄ± Ã§evir ve anÄ±nda MC kazan! ArkadaÅŸlarÄ±nla Online PiÅŸti, Crash ve zeka oyunlarÄ± oyna.">
<meta property="og:image" content="https://www.senindomainin.com/assets/promo-banner.jpg">
<meta property="og:url" content="https://www.senindomainin.com/">
<meta property="og:type" content="website">
<meta property="og:site_name" content="PlayMatrix">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="PlayMatrix | En Ä°yi Online Oyun Platformu">
<meta name="twitter:description" content="TarayÄ±cÄ±ndan tek tÄ±kla Ã¼cretsiz oyunlara katÄ±l ve rekabete baÅŸla.">

<script>
  if (window.history.replaceState) window.history.replaceState(null, null, "/");
</script>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;900&family=Montserrat:wght@800;900&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
/* === GELÄ°ÅžMÄ°Åž TEMA DEÄžÄ°ÅžKENLERÄ° === */
:root {
    --primary: #00f0ff;
    --primary-glow: rgba(0, 240, 255, 0.5);
    --secondary: #0055ff;
    --accent: #ff007a;
    --bg-main: #04060b;
    --bg-surface: #0a0e17;
    --glass-bg: rgba(10, 14, 23, 0.75);
    --glass-border: rgba(255, 255, 255, 0.08);
    --text-primary: #ffffff;
    --text-secondary: #94a3b8;
    --success: #00ffa3;
    --danger: #ff4d4d;
    --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
    --input-bg: rgba(0, 0, 0, 0.4);
}

/* AYDINLIK MOD DEÄžÄ°ÅžKENLERÄ° */
.light-mode {
    --primary: #0066ff;
    --primary-glow: rgba(0, 102, 255, 0.3);
    --secondary: #00ccff;
    --accent: #ff0055;
    --bg-main: #f4f7f9;
    --bg-surface: #ffffff;
    --glass-bg: rgba(255, 255, 255, 0.85);
    --glass-border: rgba(0, 0, 0, 0.08);
    --text-primary: #0f172a;
    --text-secondary: #475569;
    --success: #059669;
    --danger: #dc2626;
    --card-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
    --input-bg: #f1f5f9;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; font-family: 'Inter', sans-serif; transition: background-color 0.3s, border-color 0.3s, color 0.3s; }
body { background: var(--bg-main); color: var(--text-primary); overflow-x: hidden; line-height: 1.6; }

#snow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; opacity: 0.4; mix-blend-mode: screen; }
.light-mode #snow { opacity: 0.1; filter: invert(1); mix-blend-mode: multiply; }

/* === ÃœST BAR (TAÅžMA YAPMAZ, DÃœZENLÄ°) === */
.top-bar {
    position: fixed; top: 0; width: 100%; height: 70px;
    display: flex; align-items: center; justify-content: space-between;
    padding: 0 20px; background: var(--glass-bg);
    backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px);
    border-bottom: 1px solid var(--glass-border); z-index: 2000;
}

/* === 3D HAREKETLÄ° VE PARILTILI YAZI EFEKTÄ° === */
.brand-3d {
    font-family: 'Montserrat', sans-serif; font-size: 20px; font-weight: 900;
    color: var(--text-primary); text-transform: uppercase; letter-spacing: 2px;
    display: inline-block; cursor: pointer;
    animation: float3d 4s ease-in-out infinite alternate;
    text-shadow: 0 1px 0 var(--secondary), 0 2px 0 var(--secondary), 0 3px 0 #0033aa,
                 0 4px 10px var(--primary-glow), 0 0 20px var(--primary-glow);
    flex-shrink: 0;
}
@keyframes float3d {
    0% { transform: perspective(600px) rotateX(10deg) rotateY(-10deg) translateY(0px); }
    100% { transform: perspective(600px) rotateX(-5deg) rotateY(15deg) translateY(-4px);
           text-shadow: 0 1px 0 var(--secondary), 0 2px 0 var(--secondary), 0 3px 0 #0033aa,
                        0 10px 20px var(--primary-glow), 0 0 30px var(--primary-glow); }
}

.right-menu { display: flex; gap: 12px; align-items: center; }

/* TEMA BUTONU */
.theme-btn {
    background: transparent; border: 1px solid var(--glass-border); color: var(--text-primary);
    width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center;
    justify-content: center; cursor: pointer; font-size: 16px; transition: 0.3s;
}
.theme-btn:hover { background: var(--primary-glow); border-color: var(--primary); transform: rotate(15deg); }

/* PROFÄ°L ALANI */
.user-pill {
    display: none; align-items: center; gap: 12px; background: var(--bg-surface);
    padding: 5px 5px 5px 15px; border-radius: 50px; border: 1px solid var(--glass-border);
    cursor: pointer; position: relative; box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
}
.user-pill:hover { border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); }
.balance-info { display: flex; align-items: center; }
.balance-info b { font-size: 14px; color: var(--success); font-family: 'Inter', monospace; font-weight: 800;}
.mc-chip {
    width: 26px; height: 26px; background: linear-gradient(135deg, var(--primary), var(--secondary));
    border-radius: 50%; margin-left: 8px; display: flex; align-items: center; justify-content: center;
    font-size: 10px; font-weight: 900; color: #fff; box-shadow: 0 0 15px var(--primary-glow);
    border: 2px solid rgba(255,255,255,0.3); text-shadow: 0 1px 2px rgba(0,0,0,0.5);
}
.avatar { width: 34px; height: 34px; border-radius: 50%; overflow: hidden; border: 2px solid var(--primary); padding: 2px; }
.avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }

/* AÃ‡ILIR MENÃœ (DROPDOWN) */
.dropdown {
    position: absolute; top: 65px; right: 0; width: 240px;
    background: var(--glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--glass-border);
    border-radius: 16px; display: none; flex-direction: column; overflow: hidden;
    box-shadow: 0 20px 50px rgba(0,0,0,0.5); z-index: 3000; padding: 8px;
}
.dropdown.active { display: flex; animation: slideUp 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
@keyframes slideUp { from { opacity:0; transform: translateY(15px) scale(0.95); } to { opacity:1; transform: translateY(0) scale(1); } }
.drop-item {
    padding: 12px 16px; display: flex; align-items: center; gap: 12px; text-decoration: none;
    color: var(--text-primary); font-weight: 600; font-size: 13px; transition: 0.2s; border-radius: 10px;
}
.drop-item i { width: 20px; font-size: 16px; color: var(--primary); text-align: center; }
.drop-item:hover { background: var(--bg-surface); transform: translateX(5px); color: var(--primary); }

/* GENEL BUTONLAR */
.btn { padding: 10px 20px; border-radius: 12px; border: none; font-weight: 800; font-size: 12px; letter-spacing: 0.5px; cursor: pointer; transition: 0.3s; text-transform: uppercase; }
.login-btn { background: var(--bg-surface); color: var(--text-primary); border: 1px solid var(--glass-border); box-shadow: 0 4px 15px rgba(0,0,0,0.2); }
.login-btn:hover { background: rgba(255,255,255,0.1); }
.register-btn { background: linear-gradient(135deg, var(--primary), var(--secondary)); color: #fff; box-shadow: 0 5px 20px var(--primary-glow); text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
.register-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 25px var(--primary-glow); }

/* === GELÄ°ÅžMÄ°Åž DUYURU ALANI === */
.announcement-bar {
    position: fixed; top: 70px; width: 100%; height: 38px;
    background: linear-gradient(90deg, rgba(0,240,255,0.05), rgba(0,85,255,0.1), rgba(0,240,255,0.05));
    border-bottom: 1px solid var(--glass-border); z-index: 1999;
    display: flex; align-items: center; overflow: hidden; box-shadow: inset 0 -5px 10px rgba(0,0,0,0.1);
}
.announcement-icon { position: absolute; left: 15px; z-index: 10; font-size: 14px; color: var(--primary); animation: pulse 1.5s infinite; background: var(--bg-main); padding-right: 10px; box-shadow: 10px 0 10px var(--bg-main); }
@keyframes pulse { 0% { opacity: 0.6; transform: scale(0.95); } 50% { opacity: 1; transform: scale(1.1); text-shadow: 0 0 10px var(--primary); } 100% { opacity: 0.6; transform: scale(0.95); } }
.announcement-text {
    white-space: nowrap; font-size: 13px; font-weight: 700; color: var(--text-primary);
    animation: marquee 30s linear infinite; padding-left: 100%; letter-spacing: 0.5px;
}
.announcement-text span { color: var(--primary); font-weight: 900; }
@keyframes marquee { 0% { transform: translateX(0); } 100% { transform: translateX(-100%); } }

/* ARAMA VE SEO BAÅžLIK ALANI */
.hero-search { margin-top: 130px; padding: 0 20px; text-align: center; position: relative; z-index: 10; }
.seo-h1 { font-family: 'Montserrat', sans-serif; font-size: 28px; font-weight: 900; color: var(--text-primary); margin-bottom: 15px; text-shadow: 0 0 15px var(--primary-glow); padding: 0 15px; }
.seo-desc { font-size: 14px; color: var(--text-secondary); max-width: 700px; margin: 0 auto 25px auto; line-height: 1.6; padding: 0 15px; font-weight: 500; }
.search-container { max-width: 550px; margin: 0 auto; position: relative; }
.search-container i { position: absolute; left: 20px; top: 50%; transform: translateY(-50%); color: var(--text-secondary); font-size: 18px; transition: 0.3s; }
#searchInput {
    width: 100%; padding: 18px 20px 18px 50px; border-radius: 20px;
    background: var(--glass-bg); border: 1px solid var(--glass-border);
    color: var(--text-primary); outline: none; font-size: 15px; font-weight: 500;
    backdrop-filter: blur(10px); transition: all 0.3s ease; box-shadow: var(--card-shadow);
}
#searchInput:focus { border-color: var(--primary); box-shadow: 0 0 25px var(--primary-glow); background: var(--bg-surface); }
#searchInput:focus + i { color: var(--primary); }

/* KATEGORÄ° BAÅžLIKLARI */
.section-title {
    padding: 40px 10% 20px; font-size: 14px; font-weight: 900;
    text-transform: uppercase; letter-spacing: 3px; color: var(--text-secondary);
    display: flex; align-items: center; gap: 15px; position: relative; z-index: 10;
}
.section-title::before { content: ''; width: 12px; height: 12px; background: var(--primary); border-radius: 50%; box-shadow: 0 0 10px var(--primary); }
.section-title::after { content: ''; flex: 1; height: 1px; background: linear-gradient(90deg, var(--glass-border), transparent); }

/* === OYUN KARTLARI (PROFESYONEL DÃœZEN) === */
.games-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 0 10%; position: relative; z-index: 10; }
.game-card {
    background: var(--bg-surface); border-radius: 24px; padding: 35px 20px;
    text-align: center; border: 1px solid var(--glass-border); position: relative;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); cursor: pointer;
    box-shadow: var(--card-shadow); overflow: hidden;
}
.game-card::before {
    content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%;
    background: radial-gradient(circle, var(--primary-glow) 0%, transparent 60%);
    opacity: 0; transition: opacity 0.5s; pointer-events: none; z-index: 0;
}
.game-card:hover { transform: translateY(-10px); border-color: var(--primary); }
.game-card:hover::before { opacity: 0.15; }
.game-icon { font-size: 45px; margin-bottom: 20px; display: block; filter: drop-shadow(0 0 15px var(--primary-glow)); color: var(--primary); position: relative; z-index: 1; transition: 0.3s; }
.game-card:hover .game-icon { transform: scale(1.1); }
.game-card span { font-weight: 800; font-size: 17px; display: block; margin-bottom: 12px; color: var(--text-primary); position: relative; z-index: 1; }

/* ROZETLER */
.badge { font-size: 10px; font-weight: 900; padding: 6px 12px; border-radius: 8px; display: inline-block; background: rgba(255, 255, 255, 0.05); text-transform: uppercase; transition: all 0.3s ease; letter-spacing: 1px; position: relative; z-index: 1; }
.badge-free { color: var(--success) !important; background: rgba(0, 255, 163, 0.1) !important; border: 1px solid rgba(0, 255, 163, 0.2); }
.badge-danger { color: var(--danger) !important; background: rgba(255, 77, 77, 0.1) !important; border: 1px solid rgba(255, 77, 77, 0.2); }
.badge-success { color: var(--success) !important; background: rgba(0, 255, 163, 0.1) !important; border: 1px solid rgba(0, 255, 163, 0.2); }

/* === FOOTER VE 3D FLOOD ALANI === */
.footer { background: var(--bg-surface); padding: 50px 20px; border-top: 1px solid var(--glass-border); text-align: center; margin-top: 80px; position: relative; z-index: 10; box-shadow: 0 -10px 30px rgba(0,0,0,0.2); }
.social-icons { display: flex; justify-content: center; gap: 15px; margin: 25px 0; }
.social-btn {
    width: 45px; height: 45px; background: var(--bg-main); border-radius: 12px;
    display: flex; align-items: center; justify-content: center; transition: 0.4s;
    border: 1px solid var(--glass-border); text-decoration: none; color: var(--text-primary); font-size: 20px;
}
.social-btn:hover { background: linear-gradient(135deg, var(--primary), var(--secondary)); transform: translateY(-5px) rotate(10deg); color: #fff; border-color: transparent; box-shadow: 0 10px 20px var(--primary-glow); }

/* === PROFESYONEL MODALLAR (GLASSMORPHISM) === */
.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.6); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
    display: none; align-items: center; justify-content: center; z-index: 5000; opacity: 0;
    transition: opacity 0.3s ease;
}
.modal-overlay.show { opacity: 1; display: flex; }
.modal-card {
    width: 90%; max-width: 420px; padding: 35px 30px; border-radius: 28px;
    background: var(--bg-surface); border: 1px solid var(--glass-border); text-align: center;
    max-height: 90vh; overflow-y: auto; box-shadow: 0 25px 50px rgba(0,0,0,0.5);
    transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
}
.modal-overlay.show .modal-card { transform: scale(1); }
.modal-close-btn { position: absolute; top: 20px; right: 20px; font-size: 20px; color: var(--text-secondary); cursor: pointer; transition: 0.3s; }
.modal-close-btn:hover { color: var(--danger); transform: rotate(90deg); }
.modal-card h2 { margin-bottom: 25px; font-size: 24px; font-weight: 900; color: var(--text-primary); letter-spacing: 0.5px; }
.modal-card input {
    width: 100%; padding: 16px; margin-bottom: 15px; border-radius: 14px;
    background: var(--input-bg); border: 1px solid var(--glass-border);
    color: var(--text-primary); outline: none; text-align: left; font-size: 14px; transition: 0.3s; font-weight: 500;
}
.modal-card input:focus { border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); background: var(--bg-main); }
.modal-card input:disabled { opacity: 0.6; cursor: not-allowed; }
.modal-btn {
    width: 100%; padding: 16px; border-radius: 14px; border: none;
    background: linear-gradient(135deg, var(--primary), var(--secondary));
    color: #fff; font-weight: 900; font-size: 15px; letter-spacing: 1px; cursor: pointer;
    box-shadow: 0 8px 20px var(--primary-glow); transition: 0.3s; text-transform: uppercase; margin-top: 10px;
}
.modal-btn:hover { transform: translateY(-2px); box-shadow: 0 12px 25px var(--primary-glow); }

/* AVATAR GRID - EKSÄ°KSÄ°Z VE DÃœZENLÄ° */
.avatar-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px; margin: 20px 0; background: var(--input-bg); padding: 15px; border-radius: 20px; border: 1px solid var(--glass-border); }
.avatar-item { width: 100%; aspect-ratio: 1/1; border-radius: 12px; cursor: pointer; border: 3px solid transparent; transition: 0.3s; overflow: hidden; position: relative; }
.avatar-item img { width: 100%; height: 100%; object-fit: cover; transition: 0.3s; }
.avatar-item:hover { transform: scale(1.05); }
.avatar-item.active { border-color: var(--primary); box-shadow: 0 0 15px var(--primary-glow); transform: scale(1.1); z-index: 2; }

/* PROMO MESAJLARI */
.promo-msg { font-size: 13px; margin-top: 5px; font-weight: 800; min-height: 20px; letter-spacing: 0.5px; }
.promo-error { color: var(--danger); text-shadow: 0 0 10px rgba(255, 77, 77, 0.4); }
.promo-success { color: var(--success); text-shadow: 0 0 10px rgba(0, 255, 163, 0.4); }
.auth-error-area { color: var(--danger); font-size: 13px; font-weight: 800; margin-top: 10px; min-height: 20px; display: block; text-align: center; }

/* Ã‡ARK ALANI - ZARAR GÃ–RMEDÄ°, GÃœZELLEÅžTÄ°RÄ°LDÄ° */
.wheel-container { position: relative; width: 280px; height: 280px; margin: 25px auto; }
#wheelCanvas {
    width: 100%; height: 100%; border-radius: 50%;
    transition: transform 5s cubic-bezier(0.15, 0, 0.15, 1);
    box-shadow: 0 0 40px rgba(0,0,0,0.6), 0 0 0 10px var(--bg-main), 0 0 20px 10px var(--primary-glow);
}
.wheel-pointer {
    position: absolute; top: -15px; left: 50%; transform: translateX(-50%);
    width: 36px; height: 46px; background: #fff;
    clip-path: polygon(50% 100%, 0 0, 100% 0); z-index: 100;
    filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.5));
}
.wheel-center {
    position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);
    width: 60px; height: 60px; background: var(--bg-main);
    border: 4px solid var(--primary); border-radius: 50%; z-index: 10;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 0 20px var(--primary-glow), inset 0 0 10px rgba(0,0,0,0.5);
}
.wheel-center::after { content: 'SPIN'; color: var(--primary); font-weight: 900; font-size: 14px; letter-spacing: 1px; }
#wheelResultText { color: var(--success); font-weight: 900; font-size: 16px; margin-top: 20px; min-height: 28px; text-shadow: 0 0 15px rgba(0, 255, 163, 0.4); letter-spacing: 0.5px;}

/* MOBÄ°L UYUM (TAÅžMA ENGELLENDÄ°) */
@media(max-width: 768px) {
    .seo-h1 { font-size: 20px; }
    .seo-desc { font-size: 12px; margin-bottom: 20px; }
    .games-grid { grid-template-columns: repeat(2, 1fr); gap: 12px; padding: 0 15px; }
    .top-bar { padding: 0 10px; height: 65px; }
    .brand-3d { font-size: 16px; }
    .user-pill { padding: 4px 4px 4px 10px; gap: 8px; }
    .balance-info b { font-size: 12px; }
    .mc-chip { width: 22px; height: 22px; font-size: 9px; }
    .avatar { width: 28px; height: 28px; }
    .btn { padding: 8px 12px; font-size: 10px; }
    .theme-btn { width: 32px; height: 32px; font-size: 14px; }
    .announcement-bar { top: 65px; height: 32px; }
    .announcement-text { font-size: 11px; }
    .hero-search { margin-top: 110px; }
    .section-title { padding: 30px 15px 15px; font-size: 12px; }
    .wheel-container { width: 240px; height: 240px; }
}
@media(max-width: 380px) {
    .games-grid { grid-template-columns: repeat(1, 1fr); }
    .brand-3d { font-size: 14px; }
    .right-menu { gap: 6px; }
    .btn { padding: 6px 8px; font-size: 9px; }
}
</style>
</head>
<body>

<canvas id="snow"></canvas>

<header class="top-bar">
    <div class="brand-3d" onclick="window.scrollTo({top:0, behavior:'smooth'})">PlayMatrix</div>
    <nav class="right-menu">
        <button class="theme-btn" id="themeToggle" onclick="toggleTheme()" aria-label="Tema DeÄŸiÅŸtir"><i class="fa-solid fa-moon"></i></button>
        <button class="btn login-btn" id="loginBtn">GÄ°RÄ°Åž</button>
        <button class="btn register-btn" id="regBtn">KAYIT OL</button>

        <div class="user-pill" id="userPill">
            <div class="balance-info">
                <b id="userBalance">0</b>
                <div class="mc-chip">MC</div>
            </div>
            <div class="avatar" id="avatarTrigger">
                <img src="" id="userProfileImg" alt="KullanÄ±cÄ± Profil AvatarÄ±">
            </div>
            <div class="dropdown" id="userDropdown">
                <div class="drop-item" onclick="openModal('profileModal')"><i class="fa-solid fa-user-astronaut"></i> Profil AyarlarÄ±</div>
                <div class="drop-item" onclick="openModal('wheelModal')"><i class="fa-solid fa-dharmachakra"></i> GÃ¼nlÃ¼k Ã‡ark</div>
                <div class="drop-item" onclick="openModal('bonusModal')"><i class="fa-solid fa-gift"></i> Promosyon Kodu</div>
                <div class="drop-item" id="logoutBtn" style="color:var(--danger); border-top:1px solid var(--glass-border); margin-top:5px;"><i class="fa-solid fa-power-off"></i> GÃ¼venli Ã‡Ä±kÄ±ÅŸ</div>
            </div>
        </div>
    </nav>
</header>

<div class="announcement-bar">
    <div class="announcement-icon"><i class="fa-solid fa-bolt"></i></div>
    <div class="announcement-text" id="announcementText">
        ðŸš€ <span>SÄ°STEM BÄ°LDÄ°RÄ°MÄ°:</span> PLAYMATRÄ°X'Ä°N YENÄ° PROFESYONEL ARAYÃœZÃœNE HOÅž GELDÄ°NÄ°Z! â€¢ GÃœNLÃœK Ã‡ARKINIZI Ã‡EVÄ°REREK <span>50.000 MC</span>'YE KADAR KAZANMAYI ÅžANSINIZ OLDUÄžUNU UNUTMAYIN! â€¢ YENÄ° MULTIPLAYER OYUNLARIMIZ YAKINDA SÄ°ZLERÄ°E...
    </div>
</div>

<div class="hero-search">
    <h1 class="seo-h1">PlayMatrix: Ãœcretsiz Online Multiplayer ve Zeka OyunlarÄ±</h1>
    <p class="seo-desc">TarayÄ±cÄ±nÄ±z Ã¼zerinden hiÃ§bir kurulum yapmadan arkadaÅŸlarÄ±nÄ±zla online piÅŸti, yetenek ve zeka oyunlarÄ± oynayÄ±n. KayÄ±t olun, gÃ¼nlÃ¼k ÅŸans Ã§arkÄ±nÄ± Ã§evirin ve binlerce MC Ã¶dÃ¼lÃ¼yle arenaya hemen katÄ±lÄ±n!</p>

    <div class="search-container">
        <input type="text" id="searchInput" placeholder="Favori oyununuzu arayÄ±n..." aria-label="Oyun Ara">
        <i class="fa-solid fa-magnifying-glass" aria-hidden="true"></i>
    </div>
</div>

<main id="games">
    <div class="section-title">Multiplayer Arena</div>
    <div class="games-grid">
        <div class="game-card" data-name="Online PiÅŸti" onclick="checkLogin('OnlinePisti.html')">
            <div class="game-icon"><i class="fa-solid fa-hand-fist" aria-hidden="true"></i></div>
            <span>Online PiÅŸti</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
        <div class="game-card" data-name="Online Grid Conquest" onclick="checkLogin('GridConquest.html')">
            <div class="game-icon"><i class="fa-solid fa-border-all" aria-hidden="true"></i></div>
            <span>Grid Conquest</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
        <div class="game-card" data-name="Online SatranÃ§" onclick="checkLogin('Satranc.html')">
            <div class="game-icon"><i class="fa-solid fa-chess-knight" aria-hidden="true"></i></div>
            <span>Online SatranÃ§</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
    </div>

    <div class="section-title">Zeka & Strateji</div>
    <div class="games-grid">
        <div class="game-card" data-name="loops cyber" onclick="location.href='Cyber.html'">
            <div class="game-icon"><i class="fa-solid fa-infinity" aria-hidden="true"></i></div>
            <span>Cyber</span>
            <div class="badge badge-free">ÃœCRETSÄ°Z OYNA</div>
        </div>
        <div class="game-card" data-name="Pattern Master" onclick="location.href='PatternMaster.html'">
            <div class="game-icon"><i class="fa-solid fa-shapes" aria-hidden="true"></i></div>
            <span>Pattern Master</span>
            <div class="badge badge-free">ÃœCRETSÄ°Z OYNA</div>
        </div>
    </div>

    <div class="section-title">Premium Casino</div>
    <div class="games-grid">
        <div class="game-card" data-name="Crash" onclick="checkLogin('Crash.html')">
            <div class="game-icon"><i class="fa-solid fa-plane-up" aria-hidden="true"></i></div>
            <span>Crash</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
        <div class="game-card" data-name="Mines" onclick="checkLogin('Mines.html')">
            <div class="game-icon"><i class="fa-solid fa-land-mine-on" aria-hidden="true"></i></div>
            <span>Mines</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
        <div class="game-card" data-name="BlackJack" onclick="checkLogin('BlackJack.html')">
            <div class="game-icon"><i class="fa-solid fa-diamond" aria-hidden="true"></i></div>
            <span>BlackJack</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
        <div class="game-card" data-name="PiÅŸti Casino" onclick="checkLogin('Pisti.html')">
            <div class="game-icon"><i class="fa-solid fa-clone" aria-hidden="true"></i></div>
            <span>PiÅŸti</span>
            <div class="badge auth-badge">GÄ°RÄ°Åž GEREKÄ°R</div>
        </div>
    </div>

    <div class="section-title">Arcade Classics</div>
    <div class="games-grid">
        <div class="game-card" data-name="Space Pro" onclick="location.href='SpacePro.html'">
            <div class="game-icon"><i class="fa-solid fa-user-astronaut" aria-hidden="true"></i></div>
            <span>Space Pro</span>
            <div class="badge badge-free">ÃœCRETSÄ°Z OYNA</div>
        </div>
        <div class="game-card" data-name="Snake Pro" onclick="location.href='SnakePro.html'">
            <div class="game-icon"><i class="fa-solid fa-worm" aria-hidden="true"></i></div>
            <span>Snake Pro</span>
            <div class="badge badge-free">ÃœCRETSÄ°Z OYNA</div>
        </div>
        <div class="game-card" data-name="Tower Stack" onclick="location.href='TowerStack.html'">
            <div class="game-icon"><i class="fa-solid fa-layer-group" aria-hidden="true"></i></div>
            <span>Tower Stack</span>
            <div class="badge badge-free">ÃœCRETSÄ°Z OYNA</div>
        </div>
    </div>
</main>

<footer class="footer">
    <div class="brand-3d" style="font-size:26px; margin-bottom: 20px;">PlayMatrix</div>
    <div class="social-icons">
        <a href="https://t.me/+25bJu1XJssZhYjg8" class="social-btn" aria-label="Discord HesabÄ±mÄ±z"><i class="fa-brands fa-discord"></i></a>
        <a href="https://www.instagram.com/playmatrix_games" class="social-btn" aria-label="Instagram SayfamÄ±z"><i class="fa-brands fa-instagram"></i></a>
        <a href="https://t.me/+25bJu1XJssZhYjg8" class="social-btn" aria-label="Telegram Grubumuz"><i class="fa-brands fa-telegram"></i></a>
    </div>
    <p style="color:var(--text-secondary); font-size:12px; margin-top: 20px; font-weight: 600;">Â© 2026 PlayMatrix Global. TÃ¼m HaklarÄ± SaklÄ±dÄ±r.</p>
</footer>

<div class="modal-overlay" id="alertModal">
    <div class="modal-card">
        <div id="alertIcon" style="font-size: 50px; margin-bottom: 15px; filter: drop-shadow(0 0 10px rgba(0,0,0,0.3));"></div>
        <h2 id="alertTitle">Sistem MesajÄ±</h2>
        <p id="alertBody" style="color: var(--text-secondary); margin-bottom: 25px; font-size: 15px; font-weight: 500;"></p>
        <button class="modal-btn" onclick="closeModal('alertModal')">TAMAM</button>
    </div>
</div>

<div class="modal-overlay" id="profileModal">
    <div class="modal-card">
        <i class="fa-solid fa-xmark modal-close-btn" onclick="closeModal('profileModal')"></i>
        <h2>Profil YÃ¶netimi</h2>
        <div style="text-align:left; margin-bottom:15px;">
            <label style="font-size:12px; color:var(--text-secondary); font-weight:700; margin-left:5px;">KayÄ±tlÄ± E-posta</label>
            <input type="text" id="profEmail" disabled>
            <label style="font-size:12px; color:var(--text-secondary); font-weight:700; margin-left:5px;">Ä°sim Soyisim</label>
            <input type="text" id="profNameSurname" placeholder="Ad Soyad giriniz">
            <label style="font-size:12px; color:var(--text-secondary); font-weight:700; margin-left:5px;">Telefon NumarasÄ±</label>
            <input type="text" id="profPhone" placeholder="+90 5xx xxx xx xx">
            <label style="font-size:12px; color:var(--text-secondary); font-weight:700; margin-left:5px;">KullanÄ±cÄ± AdÄ± (Kalan Hak: <span id="userChangeCount" style="color:var(--primary)">3</span>)</label>
            <input type="text" id="profUser" placeholder="KullanÄ±cÄ± AdÄ±">
        </div>
        <div style="text-align: left; font-size: 13px; color: var(--text-primary); font-weight: 900; margin-top: 15px; text-transform:uppercase;">Avatar SeÃ§imi (Eksiksiz)</div>
        <div class="avatar-grid" id="avatarLibrary"></div>
        <button class="modal-btn" id="profileSaveBtn" onclick="updateProfile()">DEÄžÄ°ÅžÄ°KLÄ°KLERÄ° KAYDET</button>
    </div>
</div>

<div class="modal-overlay" id="bonusModal">
    <div class="modal-card">
        <i class="fa-solid fa-xmark modal-close-btn" onclick="closeModal('bonusModal')"></i>
        <i class="fa-solid fa-gift" style="font-size:50px;color:var(--primary);margin-bottom:15px; filter: drop-shadow(0 0 15px var(--primary-glow));"></i>
        <h2>Ã–dÃ¼l Merkezi</h2>
        <p style="color:var(--text-secondary); font-size:13px; margin-bottom:15px; font-weight:500;">Sosyal medya hesaplarÄ±mÄ±zdan aldÄ±ÄŸÄ±nÄ±z promosyon kodunu buraya girerek MC bakiyesi kazanabilirsiniz.</p>
        <input type="text" id="bonusInput" placeholder="PROMO KODU GÄ°RÄ°N" style="text-align: center; font-weight: 900; letter-spacing: 3px; font-size:16px; text-transform:uppercase;">
        <div id="promoFeedback" class="promo-msg"></div>
        <button class="modal-btn" id="promoBtn" onclick="claimBonus()">KODU AKTÄ°F ET</button>
    </div>
</div>

<div class="modal-overlay" id="wheelModal">
    <div class="modal-card">
        <i class="fa-solid fa-xmark modal-close-btn" onclick="closeModal('wheelModal')"></i>
        <h2>Åžans Ã‡arkÄ±</h2>
        <div class="wheel-container">
            <div class="wheel-pointer"></div>
            <div class="wheel-center"></div>
            <canvas id="wheelCanvas" width="500" height="500"></canvas>
        </div>
        <div id="wheelResultText"></div>
        <button class="modal-btn" id="spinBtn" onclick="spinWheel()" style="margin-top:20px;">ÃœCRETSÄ°Z Ã‡EVÄ°R</button>
        <div id="wheelTimer" style="margin-top:15px;font-weight:800;color:var(--text-secondary); font-size: 14px; background:var(--input-bg); padding:10px; border-radius:10px;"></div>
    </div>
</div>

<div class="modal-overlay" id="authOverlay">
    <div class="modal-card">
        <i class="fa-solid fa-xmark modal-close-btn" onclick="closeModal('authOverlay')"></i>
        <div style="font-size:40px; color:var(--primary); margin-bottom:10px;"><i class="fa-solid fa-shield-halved"></i></div>
        <h2 id="authTitle">Sisteme GiriÅŸ Yap</h2>
        <input type="text" id="authEmail" placeholder="E-posta veya KullanÄ±cÄ± AdÄ±">
        <input type="password" id="authPassword" placeholder="GÃ¼venli Åžifre">
        <input type="email" id="regEmail" placeholder="E-posta Adresi" style="display:none;">
        <input type="text" id="authUsername" placeholder="KullanÄ±cÄ± AdÄ± Belirle" style="display:none;">
        <div id="authErrorMsg" class="auth-error-area"></div>
        <button class="modal-btn" id="authSubmit">Ä°ÅžLEME DEVAM ET</button>
        <p id="switchMode" style="margin-top:20px;font-size:14px;font-weight:600;cursor:pointer;color:var(--text-secondary);">HesabÄ±n yok mu? <b style="color:var(--primary)">Hemen KayÄ±t Ol</b></p>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import {
  getAuth, onAuthStateChanged, signOut,
  signInWithEmailAndPassword, createUserWithEmailAndPassword
} from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

/* âœ… Render Sunucu (PlayMatrix Ã‡oklu Oyun Motoru) */
const API_BASE = "https://emirhan-siye.onrender.com";

/* Firebase */
const firebaseConfig = {
  apiKey:"AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
  authDomain:"emirhan-site.firebaseapp.com",
  projectId:"emirhan-site",
  storageBucket:"emirhan-site.firebasestorage.app",
  messagingSenderId:"668871888390",
  appId:"1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

/* ========= TEMA ========= */
window.toggleTheme = () => {
  document.body.classList.toggle('light-mode');
  const icon = document.querySelector('#themeToggle i');
  if(document.body.classList.contains('light-mode')) {
    icon.className = 'fa-solid fa-sun';
    localStorage.setItem('matrixTheme', 'light');
  } else {
    icon.className = 'fa-solid fa-moon';
    localStorage.setItem('matrixTheme', 'dark');
  }
};
if(localStorage.getItem('matrixTheme') === 'light') {
  document.body.classList.add('light-mode');
  document.querySelector('#themeToggle i').className = 'fa-solid fa-sun';
}

/* ========= MODAL ========= */
window.openModal = (id) => {
  const modal = document.getElementById(id);
  modal.style.display = 'flex';
  setTimeout(() => modal.classList.add('show'), 10);

  if(id === 'wheelModal') {
    drawWheel();
    document.getElementById("wheelCanvas").style.transform = "rotate(0deg)";
    currentRotation = 0;
    document.getElementById("wheelResultText").innerText = "";
    checkWheelCooldown().catch(()=>{});
  }
};
window.closeModal = (id) => {
  const modal = document.getElementById(id);
  modal.classList.remove('show');
  setTimeout(() => modal.style.display = 'none', 300);
  if(id === 'authOverlay') document.getElementById("authErrorMsg").innerText = "";
};

/* ========= UI ALERT ========= */
window.showMatrixModal = (title, message, type = 'info') => {
  const icon = document.getElementById("alertIcon");
  document.getElementById("alertTitle").innerText = title;
  document.getElementById("alertBody").innerText = message;

  if(type === 'error') icon.innerHTML = '<i class="fa-solid fa-circle-exclamation" style="color:var(--danger)"></i>';
  else if(type === 'success') icon.innerHTML = '<i class="fa-solid fa-circle-check" style="color:var(--success)"></i>';
  else icon.innerHTML = '<i class="fa-solid fa-circle-info" style="color:var(--primary)"></i>';

  openModal('alertModal');
};

/* ========= AVATAR ========= */
const avatarLinks = [
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRQwyXlGFYmEebbJwy3udOoiY1aHks5DHDL-LjNe-O2rw&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQujzeT1nbxD37pbAAGFoEQYZfH7nHKNHebtVxjQZo1vA&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQyFK0ZyigAzwNoA3Ku85fCYQ0jjn9pD4bXb3udeMJoQQ&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTfv2hkYWw-qOtoeyAoimv98hwJKq2ubPB5c8oWfw1MNg&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRPSbtgxOwnNkjU2HDU-8GsHnbDLDNuVIFhkcrd4iESTQ&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5MxBdQ6TQzrlGQ00a7K0MpnAlR1EtXPP4VQ5r3duMHQ&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ-3doyGKL8Ea3WQFJzf_aPS99XileTNMOI_ZK7WvT4ug&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSw2iCwjev-ZGXN6qsaRZIVSJiVPyWPtf00l5Vw9fBPDA&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRMiWBf7b6BRXfmPP-1cpLoP-R10mmRDcnnGdoo2-X74A&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRCHQ_Ivd7XFu1rwSWwxeznD5whsQQyWD4h1XSO7EAT4w&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQTEGm7jbVBDgiF_GSrWA_KYGbtblJwJ73YfrQ889Nmug&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRhgnTHC98ig0zq6ZxlbeCsxavfasV1SvTtZwa85aEkZg&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSOA0bH63MfODLUkfynGXq_9DzrUFCjdqqJ54SmvLSuow&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRANb8PTeKBJ5kAT8GpIZR94hQm7J770Ai7ViNCpBpp2g&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcSB1UgmpZDnWdOm3_mkMmgK2xh4j_pn0n6MRtf9GSoDMw&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS7oK5eLLGyQ-9dlF2u5PJumO-7XXFugKver64cswvAJA&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRUkEeAPrAXCyY5kZzvb17-FciLVhiSHq1z0krelJA1SQ&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcQ2foyhD4m6NkAJICHXJDOfhmpFKqRzUSTPHpxzZVOLRw&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcRmkYygtE4fo-rQ9azwFZcUkZUokE8YYrZhLKZw6UgNiw&s=10",
  "https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcS5MxBdQ6TQzrlGQ00a7K0MpnAlR1EtXPP4VQ5r3duMHQ&s=10"
];

let selectedAvatar = "";
function loadAvatars(current) {
  const container = document.getElementById("avatarLibrary");
  container.innerHTML = "";
  avatarLinks.forEach(link => {
    const div = document.createElement("div");
    div.className = `avatar-item ${link === current ? 'active' : ''}`;
    div.innerHTML = `<img src="${link}" alt="KullanÄ±cÄ± Avatar SeÃ§eneÄŸi">`;
    div.onclick = () => {
      document.querySelectorAll(".avatar-item").forEach(i => i.classList.remove("active"));
      div.classList.add("active");
      selectedAvatar = link;
    };
    container.appendChild(div);
  });
}

/* ========= SUNUCU API (ID TOKEN DUVARI) ========= */
async function apiFetch(path, method = "GET", body = null, authRequired = true) {
  const headers = { "Content-Type": "application/json" };

  if (authRequired) {
    if (!auth.currentUser) throw new Error("Oturum yok.");
    let token = await auth.currentUser.getIdToken();
    headers["Authorization"] = `Bearer ${token}`;
  }

  let res = await fetch(API_BASE + path, {
    method,
    headers,
    body: body ? JSON.stringify(body) : null,
    mode: "cors",
    cache: "no-store"
  });

  if (authRequired && res.status === 401 && auth.currentUser) {
    const token = await auth.currentUser.getIdToken(true);
    headers["Authorization"] = `Bearer ${token}`;
    res = await fetch(API_BASE + path, {
      method,
      headers,
      body: body ? JSON.stringify(body) : null,
      mode: "cors",
      cache: "no-store"
    });
  }

  const data = await res.json().catch(() => ({}));
  if (!res.ok || data?.ok === false) throw new Error(data?.error || "Sunucu hatasÄ±.");
  return data;
}

/* ========= SERVER STATE ========= */
let ME = null;
let mePoll = null;
let isBusy = false;

function setAuthUI(isLoggedIn) {
  const authBadges = document.querySelectorAll(".auth-badge");
  if (isLoggedIn) {
    document.getElementById("loginBtn").style.display="none";
    document.getElementById("regBtn").style.display="none";
    document.getElementById("userPill").style.display="flex";
    authBadges.forEach(b => { b.innerText = "ARENAYA GÄ°R"; b.className = "badge auth-badge badge-success"; });
  } else {
    document.getElementById("loginBtn").style.display="block";
    document.getElementById("regBtn").style.display="block";
    document.getElementById("userPill").style.display="none";
    authBadges.forEach(b => { b.innerText = "GÄ°RÄ°Åž GEREKÄ°R"; b.className = "badge auth-badge badge-danger"; });
  }
}

function applyMeToUI() {
  if (!ME) return;

  const bal = Number(ME.balance ?? ME.user?.balance ?? 0);
  document.getElementById("userBalance").innerText = bal.toLocaleString('tr-TR');

  const email = auth.currentUser?.email || (ME.user?.email || "");
  document.getElementById("profEmail").value = email;

  const avatar = ME.user?.avatar || avatarLinks[0];
  document.getElementById("userProfileImg").src = avatar;
  if (!selectedAvatar) selectedAvatar = avatar;
  loadAvatars(avatar);

  const fullNameInp = document.getElementById("profNameSurname");
  const phoneInp = document.getElementById("profPhone");
  const userInp = document.getElementById("profUser");

  fullNameInp.value = ME.user?.fullName || "";
  phoneInp.value = ME.user?.phone || "";
  userInp.value = ME.user?.username || "";

  // Bu alanlar doluysa kilitle (tasarÄ±m aynÄ±, gÃ¼venlik daha iyi)
  fullNameInp.disabled = !!(ME.user?.fullName);
  phoneInp.disabled = !!(ME.user?.phone);

  const used = Number(ME.user?.userChangeCount || 0);
  const remaining = Math.max(0, 3 - used);
  document.getElementById("userChangeCount").innerText = remaining;
  userInp.disabled = remaining <= 0;

  // Wheel UI
  checkWheelCooldown().catch(()=>{});
}

async function refreshMe() {
  const me = await apiFetch("/api/me", "GET", null, true);
  ME = me;
  applyMeToUI();
}

/* ========= WHEEL (SUNUCU KARARLI) ========= */
const rewards = [
  { label: "2.500 MC", val: 2500, color: "#0a0e17" },
  { label: "5.000 MC", val: 5000, color: "#111827" },
  { label: "7.500 MC", val: 7500, color: "#0a0e17" },
  { label: "12.500 MC", val: 12500, color: "#111827" },
  { label: "20.000 MC", val: 20000, color: "#0a0e17" },
  { label: "25.000 MC", val: 25000, color: "#111827" },
  { label: "30.000 MC", val: 30000, color: "#0a0e17" },
  { label: "50.000 MC", val: 50000, color: "#111827" }
];

function drawWheel() {
  const canvas = document.getElementById("wheelCanvas");
  if(!canvas) return;
  const ctx = canvas.getContext("2d");
  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = canvas.width / 2;
  const sliceAngle = (2 * Math.PI) / rewards.length;

  ctx.clearRect(0,0,canvas.width, canvas.height);

  rewards.forEach((reward, i) => {
    const angle = i * sliceAngle - Math.PI / 2;
    ctx.beginPath();
    ctx.fillStyle = reward.color;
    ctx.moveTo(centerX, centerY);
    ctx.arc(centerX, centerY, radius, angle, angle + sliceAngle);
    ctx.closePath();
    ctx.fill();
    ctx.strokeStyle = "rgba(0, 240, 255, 0.3)";
    ctx.lineWidth = 3;
    ctx.stroke();

    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(angle + sliceAngle / 2);
    ctx.textAlign = "right";
    ctx.fillStyle = i % 2 === 0 ? "#00f0ff" : "#ffffff";
    ctx.font = "bold 24px Inter";
    ctx.fillText(reward.label, radius - 30, 10);
    ctx.restore();
  });
}
setTimeout(drawWheel, 500);

let currentRotation = 0;

async function checkWheelCooldown() {
  const btn = document.getElementById("spinBtn");
  const timer = document.getElementById("wheelTimer");
  if (!auth.currentUser) {
    btn.disabled = true; btn.style.opacity = "0.5";
    timer.innerText = "GiriÅŸ yapÄ±n.";
    return;
  }

  // Sunucu: nextSpinAt timestamp dÃ¶nmeli (ms)
  // EÄŸer dÃ¶nmÃ¼yorsa, ME.user.lastSpin ile fallback (ms)
  const nextSpinAt = Number(ME?.user?.nextSpinAt || 0);
  const lastSpin = Number(ME?.user?.lastSpin || 0);
  const now = Date.now();

  const effectiveNext = nextSpinAt > 0 ? nextSpinAt : (lastSpin > 0 ? (lastSpin + 86400000) : 0);
  const diff = effectiveNext - now;

  if (diff > 0) {
    btn.disabled = true;
    btn.style.opacity = "0.5";
    const h = Math.floor(diff / 3600000);
    const m = Math.floor((diff % 3600000) / 60000);
    timer.innerText = `Sistem Bekleme SÃ¼resi: ${h} Saat ${m} Dakika`;
  } else {
    btn.disabled = false;
    btn.style.opacity = "1";
    timer.innerText = "Ã‡ark Ã‡evirmeye HazÄ±r!";
  }
}

window.spinWheel = async () => {
  if (!auth.currentUser) { openModal('authOverlay'); return; }
  if (isBusy) return;
  isBusy = true;

  const wheel = document.getElementById("wheelCanvas");
  const spinBtn = document.getElementById("spinBtn");
  const resultText = document.getElementById("wheelResultText");

  spinBtn.disabled = true;
  spinBtn.style.opacity = "0.5";
  resultText.innerText = "Kriptografik analiz yapÄ±lÄ±yor...";
  resultText.style.color = "var(--primary)";

  try {
    // âœ… SUNUCU KARAR VERÄ°R: { index, prize, balance, nextSpinAt }
    const out = await apiFetch("/api/wheel/spin", "POST", {}, true);

    const index = Number(out.index);
    const prize = Number(out.prize || rewards[index]?.val || 0);

    // Animasyonu sunucunun verdiÄŸi index'e kilitle
    const segmentDeg = 360 / rewards.length;
    const stopAt = 360 - (index * segmentDeg);
    const extraTours = 3600;
    currentRotation += extraTours + stopAt;
    wheel.style.transform = `rotate(${currentRotation}deg)`;

    setTimeout(async () => {
      resultText.innerText = `SÄ°STEM ONAYLANDI! ${prize.toLocaleString('tr-TR')} MC AktarÄ±ldÄ±.`;
      resultText.style.color = "var(--success)";

      // UI gÃ¼ncelle
      ME = ME || {};
      ME.balance = Number(out.balance ?? ME.balance ?? 0);
      ME.user = ME.user || {};
      ME.user.lastSpin = Number(out.lastSpin ?? Date.now());
      ME.user.nextSpinAt = Number(out.nextSpinAt ?? 0);
      applyMeToUI();

      await checkWheelCooldown();
      isBusy = false;
    }, 5000);

  } catch (e) {
    resultText.innerText = "";
    showMatrixModal("EriÅŸim Reddedildi", e.message || "Ã‡ark iÅŸlemi baÅŸarÄ±sÄ±z.", "error");
    spinBtn.disabled = false;
    spinBtn.style.opacity = "1";
    isBusy = false;
  }
};

/* ========= PROMO (SUNUCU KARARLI) ========= */
window.claimBonus = async () => {
  if (!auth.currentUser) { openModal('authOverlay'); return; }
  if (isBusy) return;
  isBusy = true;

  const input = document.getElementById("bonusInput");
  const feedback = document.getElementById("promoFeedback");
  const btn = document.getElementById("promoBtn");
  const code = input.value.trim().toUpperCase();
  if(!code) { isBusy = false; return; }

  feedback.innerText = "Sistem kontrol ediliyor...";
  feedback.className = "promo-msg";
  btn.disabled = true;

  try {
    // âœ… Sunucu: kota, tekrar kullanÄ±m, Ã¶dÃ¼l vb. hepsini doÄŸrular
    const out = await apiFetch("/api/promo/claim", "POST", { code }, true);

    const reward = Number(out.reward || 0);
    const bal = Number(out.balance || 0);

    feedback.innerText = `BAÅžARILI! ${reward.toLocaleString('tr-TR')} MC Bakiyenize Eklendi.`;
    feedback.classList.add("promo-success");
    input.value = "";

    ME = ME || {};
    ME.balance = bal;
    applyMeToUI();

  } catch(e) {
    feedback.innerText = "Sistem HatasÄ±: " + (e.message || "Hata");
    feedback.classList.add("promo-error");
  } finally {
    btn.disabled = false;
    isBusy = false;
  }
};

/* ========= PROFILE (SUNUCU KARARLI) ========= */
window.updateProfile = async () => {
  if (!auth.currentUser) { openModal('authOverlay'); return; }
  if (isBusy) return;
  isBusy = true;

  const btn = document.getElementById("profileSaveBtn");
  btn.disabled = true;

  try {
    const fullName = document.getElementById("profNameSurname").value.trim();
    const phone = document.getElementById("profPhone").value.trim();
    const username = document.getElementById("profUser").value.trim();
    const avatar = selectedAvatar || avatarLinks[0];

    const payload = { avatar };
    if (fullName) payload.fullName = fullName;
    if (phone) payload.phone = phone;
    if (username) payload.username = username;

    const out = await apiFetch("/api/profile/update", "POST", payload, true);

    ME = ME || {};
    ME.user = out.user || ME.user || {};
    if (typeof out.balance !== "undefined") ME.balance = Number(out.balance);
    applyMeToUI();

    showMatrixModal("Sistem GÃ¼ncellemesi", "Profil bilgileriniz aÄŸa baÅŸarÄ±yla kaydedildi.", "success");
    closeModal('profileModal');
  } catch (e) {
    showMatrixModal("Hata", e.message || "Profil gÃ¼ncellenemedi.", "error");
  } finally {
    btn.disabled = false;
    isBusy = false;
  }
};

/* ========= AUTH UI ========= */
let isLogin = true;
document.getElementById("loginBtn").onclick = () => { isLogin=true; updateAuthUI(); openModal('authOverlay'); };
document.getElementById("regBtn").onclick = () => { isLogin=false; updateAuthUI(); openModal('authOverlay'); };
document.getElementById("switchMode").onclick = () => { isLogin = !isLogin; updateAuthUI(); };

function updateAuthUI() {
  document.getElementById("authTitle").innerText = isLogin ? "Sisteme GiriÅŸ Yap" : "AÄŸa KayÄ±t Ol";
  document.getElementById("authEmail").placeholder = isLogin ? "E-posta veya KullanÄ±cÄ± AdÄ±" : "E-posta Adresi";
  document.getElementById("regEmail").style.display = isLogin ? "none" : "block";
  document.getElementById("authUsername").style.display = isLogin ? "none" : "block";
  document.getElementById("authEmail").style.display = isLogin ? "block" : "none";
  document.getElementById("authErrorMsg").innerText = "";
  document.getElementById("switchMode").innerHTML = isLogin
    ? 'HesabÄ±n yok mu? <b style="color:var(--primary)">Hemen KayÄ±t Ol</b>'
    : 'Zaten hesabÄ±n var mÄ±? <b style="color:var(--primary)">GiriÅŸ Yap</b>';
}

async function resolveUsernameToEmail(username) {
  // âœ… Public endpoint: ok + email
  const u = encodeURIComponent(username);
  const out = await apiFetch(`/api/public/resolve-username?u=${u}`, "GET", null, false);
  const email = String(out.email || "").trim();
  if (!email || !email.includes("@")) throw new Error("KullanÄ±cÄ± adÄ± aÄŸda bulunamadÄ±!");
  return email;
}

document.getElementById("authSubmit").onclick = async () => {
  const errorMsg = document.getElementById("authErrorMsg");
  const pass = document.getElementById("authPassword").value;
  errorMsg.innerText = "";

  if (isBusy) return;
  isBusy = true;

  try {
    if(isLogin) {
      const loginInput = document.getElementById("authEmail").value.trim();
      if (!loginInput || !pass) throw new Error("LÃ¼tfen giriÅŸ bilgilerini girin.");

      let finalEmail = loginInput;
      if(!loginInput.includes("@")) {
        finalEmail = await resolveUsernameToEmail(loginInput);
      }

      await signInWithEmailAndPassword(auth, finalEmail, pass);
      closeModal('authOverlay');

    } else {
      const email = document.getElementById("regEmail").value.trim();
      const userN = document.getElementById("authUsername").value.trim();

      if(!userN || !email || !pass) throw new Error("LÃ¼tfen tÃ¼m kimlik alanlarÄ±nÄ± doldurun!");

      // Firebase hesabÄ± oluÅŸtur
      const res = await createUserWithEmailAndPassword(auth, email, pass);

      // âœ… Sunucu bootstrap: username mapping + baÅŸlangÄ±Ã§ bakiyesi + profil
      // Server beklenen: { ok:true, user:{...}, balance }
      try {
        const out = await apiFetch("/api/auth/bootstrap", "POST", {
          username: userN,
          avatar: avatarLinks[0]
        }, true);

        ME = out;
        applyMeToUI();

        closeModal('authOverlay');
        showMatrixModal("AÄŸa HoÅŸ Geldiniz!", "KaydÄ±nÄ±z baÅŸarÄ±yla oluÅŸturuldu. BaÅŸlangÄ±Ã§ desteÄŸi olarak hesabÄ±nÄ±za MC tanÄ±mlandÄ±.", "success");
      } catch (e) {
        // Bootstrap baÅŸarÄ±sÄ±zsa gÃ¼venli Ã§Ä±kÄ±ÅŸ (yarÄ±m kayÄ±t kalsÄ±n istemiyoruz)
        await signOut(auth);
        throw new Error(e.message || "KayÄ±t tamamlanamadÄ± (bootstrap).");
      }
    }
  } catch(e) {
    if(e.code === "auth/email-already-in-use") errorMsg.innerText = "Bu e-posta adresi sistemde zaten kayÄ±tlÄ±!";
    else if(e.code === "auth/wrong-password") errorMsg.innerText = "Kimlik doÄŸrulama baÅŸarÄ±sÄ±z. HatalÄ± ÅŸifre!";
    else if(e.code === "auth/invalid-credential") errorMsg.innerText = "Kimlik doÄŸrulama baÅŸarÄ±sÄ±z.";
    else errorMsg.innerText = e.message || "Hata oluÅŸtu.";
  } finally {
    isBusy = false;
  }
};

/* ========= DROPDOWN / LOGOUT ========= */
document.getElementById("avatarTrigger").onclick = (e) => {
  e.stopPropagation();
  document.getElementById("userDropdown").classList.toggle("active");
};
window.onclick = (e) => {
  if(!e.target.closest('#userPill')) document.getElementById("userDropdown").classList.remove("active");
};
document.getElementById("logoutBtn").onclick = async () => {
  try { await signOut(auth); } catch {}
};

/* ========= AUTH STATE ========= */
onAuthStateChanged(auth, async (user) => {
  if (mePoll) { clearInterval(mePoll); mePoll = null; }
  ME = null;

  if (!user) {
    setAuthUI(false);
    return;
  }

  setAuthUI(true);

  // Ä°lk ME Ã§ek
  try {
    await refreshMe();
  } catch (e) {
    showMatrixModal("BaÄŸlantÄ± HatasÄ±", "Sunucuya baÄŸlanÄ±lamadÄ±. LÃ¼tfen internetinizi kontrol edin.", "error");
  }

  // Performans: 10sn poll (Ã§ok sÄ±k deÄŸil)
  mePoll = setInterval(() => {
    if (!isBusy) refreshMe().catch(()=>{});
  }, 10000);
});

/* ========= OYUN GÄ°RÄ°Åž KONTROL ========= */
window.checkLogin = (url) => {
  if(!auth.currentUser) openModal('authOverlay');
  else location.href = url;
};

/* ========= SEARCH ========= */
let searchT = null;
document.getElementById('searchInput').addEventListener('input', (e) => {
  const val = e.target.value;
  if (searchT) clearTimeout(searchT);
  searchT = setTimeout(() => {
    const term = val.toLowerCase().trim();
    document.querySelectorAll('.game-card').forEach(card => {
      const name = (card.getAttribute('data-name') || "").toLowerCase();
      if(name.includes(term)) {
        card.style.display = 'block';
        setTimeout(() => card.style.opacity = '1', 10);
      } else {
        card.style.opacity = '0';
        setTimeout(() => card.style.display = 'none', 300);
      }
    });
  }, 80);
});

/* ========= SNOW ========= */
const canvasSnow = document.getElementById("snow");
const ctxS = canvasSnow.getContext("2d");
let particles = [];
function resize() {
  canvasSnow.width = window.innerWidth;
  canvasSnow.height = window.innerHeight;
}
window.onresize = resize; resize();
for(let i=0; i<70; i++) particles.push({
  x:Math.random()*canvasSnow.width,
  y:Math.random()*canvasSnow.height,
  r:Math.random()*2+0.5,
  d:Math.random()*1+0.5
});
function drawSnow() {
  ctxS.clearRect(0,0,canvasSnow.width, canvasSnow.height);
  ctxS.fillStyle = "rgba(0, 240, 255, 0.4)";
  ctxS.beginPath();
  particles.forEach(p => {
    ctxS.moveTo(p.x, p.y);
    ctxS.arc(p.x, p.y, p.r, 0, Math.PI*2);
    p.y += p.d;
    if(p.y > canvasSnow.height) p.y = -5;
  });
  ctxS.fill();
  requestAnimationFrame(drawSnow);
}
drawSnow();

/* Ä°lk load avatar */
loadAvatars(avatarLinks[0]);
</script>
</body>
</html>
