<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <title>PlayMatrix - Tower Stack | Gökdelen İnşa Etme Oyunu</title>
    <meta name="description" content="PlayMatrix Tower Stack oyna! Kule bloklarını mükemmel zamanlamayla üst üste diz, göklere ulaş ve en yüksek rekoru sen kır. Ücretsiz, 3D zeka ve refleks oyunu.">
    <meta name="keywords" content="tower stack oyna, kule yapma oyunu, kule dizme oyunu, 3d oyunlar, PlayMatrix, refleks oyunu, ücretsiz tarayıcı oyunu, beceri oyunu">
    <meta name="author" content="PlayMatrix Global">
    <meta name="robots" content="index, follow">
    <meta name="language" content="Turkish">
    <meta name="theme-color" content="#03050a">
    <link rel="canonical" href="https://playmatrix.com.tr/TowerStack.html">

    <meta property="og:title" content="PlayMatrix Tower Stack | Kuleyi Ne Kadar Yükseltebilirsin?">
    <meta property="og:description" content="Blokları üst üste diz ve en yüksek kuleyi inşa et. Şansını denemek için hemen oyna!">
    <meta property="og:image" content="https://playmatrix.com.tr/assets/tower-promo.jpg">
    <meta property="og:url" content="https://playmatrix.com.tr/TowerStack.html">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="PlayMatrix">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="PlayMatrix Tower Stack Oyunu">
    <meta name="twitter:description" content="Reflekslerini test et! 3D ortamda kule bloklarını düşürmeden göğe kadar dizmeye çalış.">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Montserrat:wght@900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        if (window.history.replaceState) {
            window.history.replaceState(null, null, "/");
        }
    </script>
    
    <style>
        :root {
            --primary: #4fd1ff;
            --bg: #03050a;
            --glass: rgba(10, 15, 25, 0.85);
            --border: rgba(255, 255, 255, 0.15);
            --danger: #ff4d4d;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { background: var(--bg); color: white; font-family: 'Inter', sans-serif; overflow: hidden; height: 100vh; }

        /* SEO İÇİN GİZLİ H1 SINIFI */
        .sr-only {
            position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
            overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0;
        }

        /* --- ANİMASYONLU NEON ARKA PLAN --- */
        #bg-canvas { position: fixed; inset: 0; z-index: -1; }

        /* --- ÜST BAR --- */
        .top-bar {
            height: 65px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 15px; background: var(--glass); backdrop-filter: blur(25px);
            border-bottom: 1px solid var(--border); position: relative; z-index: 1000;
        }

        .brand { 
            font-family: 'Montserrat', sans-serif; font-size: 16px; font-weight: 900; 
            color: var(--primary); text-shadow: 0 0 15px rgba(79, 209, 255, 0.6); 
        }
        
        .stat-group { display: flex; gap: 10px; align-items: center; }
        .stat-pill { 
            background: rgba(255,255,255,0.05); padding: 6px 12px; border-radius: 10px; 
            border: 1px solid var(--border); font-size: 12px; font-weight: 800; 
            display: flex; align-items: center; gap: 6px; box-shadow: inset 0 2px 5px rgba(0,0,0,0.5);
        }
        
        .exit-btn { 
            background: rgba(255, 77, 77, 0.15); border: 1px solid var(--danger); color: var(--danger); 
            padding: 6px 14px; border-radius: 8px; font-size: 11px; font-weight: 900; 
            cursor: pointer; text-decoration: none; transition: 0.2s;
        }
        .exit-btn:active { transform: scale(0.95); background: rgba(255, 77, 77, 0.3); }

        /* --- OYUN ALANI --- */
        #game-container { width: 100%; height: calc(100vh - 65px); position: relative; }
        canvas#stackCanvas { width: 100%; height: 100%; display: block; }

        .game-overlay { 
            position: absolute; inset: 0; pointer-events: none; 
            display: flex; align-items: center; justify-content: center; z-index: 100; 
        }
        
        .modal { 
            background: rgba(10, 15, 25, 0.95); padding: 40px 30px; border-radius: 20px; 
            border: 1px solid var(--primary); text-align: center; backdrop-filter: blur(20px); 
            pointer-events: auto; width: 85%; max-width: 320px; 
            box-shadow: 0 15px 50px rgba(0,0,0,0.8), inset 0 0 20px rgba(79, 209, 255, 0.1); 
        }
        
        .btn-action { 
            width: 100%; padding: 16px; border-radius: 12px; border: none; 
            background: linear-gradient(135deg, var(--primary), #007aff); color: #fff; font-weight: 900; 
            cursor: pointer; text-transform: uppercase; box-shadow: 0 5px 20px rgba(79, 209, 255, 0.4); 
            transition: 0.2s; letter-spacing: 1px;
        }
        .btn-action:active { transform: translateY(4px); box-shadow: 0 2px 10px rgba(79, 209, 255, 0.4); }
        
        #score-display { 
            position: absolute; top: 30px; font-size: 130px; font-family: 'Montserrat'; font-weight: 900; 
            color: white; opacity: 0.08; text-shadow: 0 0 20px rgba(255,255,255,0.2); 
            pointer-events: none;
        }
    </style>
</head>
<body onclick="gameInput()">

    <h1 class="sr-only">PlayMatrix Tower Stack - Kule İnşa Etme Oyunu</h1>

    <canvas id="bg-canvas" aria-hidden="true"></canvas>

    <header class="top-bar">
        <div class="brand">TOWER STACK</div>
        <div class="stat-group" aria-label="Skor Tablosu">
            <div class="stat-pill" aria-label="En Yüksek Skor"><i class="fa-solid fa-trophy" aria-hidden="true"></i> <span id="highScore">0</span></div>
            <div class="stat-pill" aria-label="Mevcut Skor"><i class="fa-solid fa-layer-group" aria-hidden="true"></i> <span id="currentScore">0</span></div>
            <a href="index.html" class="exit-btn" aria-label="Ana Sayfaya Dön">ÇIKIŞ</a>
        </div>
    </header>

    <main id="game-container">
        <canvas id="stackCanvas" aria-label="Kule Oyun Alanı"></canvas>
        
        <div class="game-overlay">
            <div id="score-display" aria-hidden="true">0</div>
            
            <div id="start-ui" class="modal" role="dialog" aria-modal="true">
                <h2 style="font-family:'Montserrat'; margin-bottom:10px; color:var(--primary); font-size:22px; letter-spacing:1px;">TOWER STACK</h2>
                <p style="color:#94a3b8; font-size:13px; margin-bottom:25px; line-height:1.5;">Katları eksiksiz üst üste diz ve göklere çık.</p>
                <button class="btn-action" onclick="startGame(event)" aria-label="Oyunu Başlat">OYUNA BAŞLA</button>
            </div>
            
            <div id="game-over-ui" class="modal" style="display:none;" role="dialog" aria-modal="true">
                <h2 style="font-family:'Montserrat'; margin-bottom:10px; color:var(--danger); font-size:22px; letter-spacing:1px;">İNŞA HATASI</h2>
                <p style="color:#94a3b8; font-size:14px; margin-bottom:25px;">Kule devrildi. Ulaşılan kat: <br><b id="finalScore" style="color:white; font-size: 24px; display:inline-block; margin-top:5px;">0</b></p>
                <button class="btn-action" onclick="restartGame(event)" aria-label="Tekrar Oyna">YENİDEN İNŞA ET</button>
            </div>
        </div>
    </main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
<script>
    // --- SES SİSTEMİ (iOS UYUMLU) ---
    const sounds = {
        // Yeni Giriş Sesi (Epic Cyber Intro)
        intro: new Audio('https://assets.mixkit.co/active_storage/sfx/2019/2019-preview.mp3'),
        // Her kule konulduğunda (High Tech Click)
        place: new Audio('https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3'),
        // Kaybetme Sesi
        fail: new Audio('https://assets.mixkit.co/active_storage/sfx/253/253-preview.mp3')
    };

    function unlockAudio() {
        Object.values(sounds).forEach(sound => {
            sound.play().then(() => {
                sound.pause();
                sound.currentTime = 0;
            }).catch(e => console.log(e));
        });
    }

    // --- ARKA PLAN ANİMASYONU (Matrix Neon Lines - Derinlik Artırıldı) ---
    const bgCanvas = document.getElementById('bg-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    let particles = [];

    function initBG() {
        bgCanvas.width = window.innerWidth;
        bgCanvas.height = window.innerHeight;
        for(let i=0; i<30; i++) {
            particles.push({
                x: Math.random() * bgCanvas.width,
                y: Math.random() * bgCanvas.height,
                speed: 0.5 + Math.random() * 1.5, // Yağmur hızı yavaşlatılıp akıcılaştırıldı
                len: 30 + Math.random() * 80,
                opacity: Math.random() * 0.5 + 0.1
            });
        }
    }

    function drawBG() {
        bgCtx.fillStyle = 'rgba(3, 5, 10, 0.4)'; // Arkada iz bırakan flu efekt
        bgCtx.fillRect(0, 0, bgCanvas.width, bgCanvas.height);
        
        particles.forEach(p => {
            bgCtx.strokeStyle = `rgba(79, 209, 255, ${p.opacity})`;
            bgCtx.lineWidth = 1.5;
            bgCtx.beginPath();
            bgCtx.moveTo(p.x, p.y);
            bgCtx.lineTo(p.x, p.y + p.len);
            bgCtx.stroke();
            p.y += p.speed;
            if(p.y > bgCanvas.height) {
                p.y = -p.len;
                p.x = Math.random() * bgCanvas.width;
            }
        });
        requestAnimationFrame(drawBG);
    }

    // --- OYUN MOTORU (THREE.JS) ---
    let scene, camera, renderer, stack = [], debris = [];
    let gameStarted = false, gameOver = false;
    let score = 0, highScore = localStorage.getItem('stack_highscore') || 0;
    
    // Hız Dinamikleri (Başlangıçta yavaş, yavaş yavaş hızlanan stabil yapı)
    const baseSpeed = 0.10;
    let speed = baseSpeed;

    function initGame() {
        document.getElementById('highScore').innerText = highScore;
        scene = new THREE.Scene();
        // Uzay derinliği hissi (Sis Eklendi)
        scene.fog = new THREE.FogExp2(0x03050a, 0.02);

        const aspect = window.innerWidth / (window.innerHeight - 65);
        camera = new THREE.OrthographicCamera(-5*aspect, 5*aspect, 5, -5, 0.1, 100);
        camera.position.set(5, 5, 5); 
        camera.lookAt(0, 0, 0);

        renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('stackCanvas'), antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight - 65);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2)); // Mobil performans artışı
        
        // Işıklandırma Güçlendirildi (Kulelere Premium Bir Hava Verildi)
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.7);
        scene.add(ambientLight);
        
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.6);
        dirLight.position.set(10, 20, 10); 
        scene.add(dirLight);
        
        const sideLight = new THREE.DirectionalLight(0x4fd1ff, 0.3); // Mavi yan ışık (Matrix Vibe)
        sideLight.position.set(-10, 0, -10);
        scene.add(sideLight);

        resetLevel();
        animate();
    }

    function resetLevel() {
        stack.forEach(b => scene.remove(b.mesh));
        debris.forEach(d => scene.remove(d.mesh));
        stack = []; debris = [];
        score = 0; speed = baseSpeed;
        updateUI();
        addBlock(0, 0, 3, 3, null); // Base Tabana Oturtulan Sabit Blok
        addBlock(0, 0, 3, 3, 'x'); // Hareket Eden İlk Blok
    }

    function addBlock(x, z, w, d, dir) {
        const y = stack.length;
        // Dinamik Renk Skalası (Her katta renk değişir)
        const color = new THREE.Color().setHSL((stack.length * 0.04) % 1, 0.8, 0.55);
        const mesh = new THREE.Mesh(
            new THREE.BoxGeometry(w, 1, d),
            new THREE.MeshLambertMaterial({ color: color })
        );
        mesh.position.set(x, y, z);
        scene.add(mesh);
        stack.push({ mesh, width: w, depth: d, direction: dir });
    }

    function addDebris(x, y, z, w, d) {
        const color = stack[stack.length - 1].mesh.material.color;
        const mesh = new THREE.Mesh(new THREE.BoxGeometry(w, 1, d), new THREE.MeshPhongMaterial({ color, transparent: true, opacity: 0.8 }));
        mesh.position.set(x, y, z);
        scene.add(mesh);
        // Düşme hızına rotasyon da eklendi (Daha gerçekçi)
        debris.push({ mesh, velocity: -0.1, rotX: (Math.random()-0.5)*0.1, rotZ: (Math.random()-0.5)*0.1 });
    }

    function gameInput() {
        if (!gameStarted || gameOver) return;

        const top = stack[stack.length - 1];
        const prev = stack[stack.length - 2];
        const dir = top.direction;

        const delta = dir === 'x' ? top.mesh.position.x - prev.mesh.position.x : top.mesh.position.z - prev.mesh.position.z;
        const size = dir === 'x' ? top.width : top.depth;
        const overlap = size - Math.abs(delta);

        if (overlap > 0) {
            // HER KULE KONULDUĞUNDA SES 
            if(sounds.place) {
                sounds.place.currentTime = 0;
                sounds.place.play().catch(e => console.log(e));
            }
            
            const newW = dir === 'x' ? overlap : top.width;
            const newD = dir === 'z' ? overlap : top.depth;
            const newX = dir === 'x' ? prev.mesh.position.x + delta/2 : top.mesh.position.x;
            const newZ = dir === 'z' ? prev.mesh.position.z + delta/2 : top.mesh.position.z;

            // Parça Düşürme (Debris)
            const dSize = size - overlap;
            let dX = newX, dZ = newZ;
            if(dir === 'x') dX += (delta > 0 ? overlap/2 + dSize/2 : -overlap/2 - dSize/2);
            else dZ += (delta > 0 ? overlap/2 + dSize/2 : -overlap/2 - dSize/2);
            addDebris(dX, top.mesh.position.y, dZ, dir === 'x' ? dSize : newW, dir === 'z' ? dSize : newD);

            top.mesh.scale[dir] = overlap / size;
            top.mesh.position.set(newX, top.mesh.position.y, newZ);
            top.width = newW; top.depth = newD;

            score++;
            if(score > highScore) { highScore = score; localStorage.setItem('stack_highscore', highScore); }
            updateUI();
            
            // Oyun hızı çok yavaş artar, imkansızlaşmaz
            if (speed > 0) speed += 0.003;
            else speed -= 0.003;

            addBlock(newX, newZ, newW, newD, dir === 'x' ? 'z' : 'x');
            // Kamera Yumuşak Geçiş İçin Yukarı Kayar
            camera.position.y += 1;
        } else {
            if(sounds.fail) sounds.fail.play().catch(e => console.log(e));
            gameOver = true;
            document.getElementById('game-over-ui').style.display = 'block';
            document.getElementById('finalScore').innerText = score;
        }
    }

    function animate() {
        requestAnimationFrame(animate);
        if (gameStarted && !gameOver) {
            const top = stack[stack.length - 1];
            top.mesh.position[top.direction] += speed;
            // Dışarı taşma limiti ayarlandı
            if (Math.abs(top.mesh.position[top.direction]) > 5.5) speed *= -1;
        }
        
        // Düşen parçaların rotasyonlu düşüşü
        debris.forEach((d, i) => {
            d.velocity -= 0.01;
            d.mesh.position.y += d.velocity;
            d.mesh.rotation.x += d.rotX;
            d.mesh.rotation.z += d.rotZ;
            if (d.mesh.position.y < -10) { scene.remove(d.mesh); debris.splice(i, 1); }
        });
        renderer.render(scene, camera);
    }

    function updateUI() {
        document.getElementById('currentScore').innerText = score;
        document.getElementById('score-display').innerText = score;
        document.getElementById('highScore').innerText = highScore;
    }

    window.startGame = (e) => {
        e.stopPropagation();
        unlockAudio(); // iOS SES KİLİDİNİ AÇAR
        if(sounds.intro) sounds.intro.play().catch(e => console.log(e));
        gameStarted = true;
        document.getElementById('start-ui').style.display = 'none';
    };

    window.restartGame = (e) => {
        e.stopPropagation();
        gameOver = false;
        camera.position.y = 5;
        camera.position.set(5, 5, 5); // Kamera ilk konuma döner
        document.getElementById('game-over-ui').style.display = 'none';
        resetLevel();
    };

    initBG();
    drawBG();
    initGame();
</script>
</body>
</html>
