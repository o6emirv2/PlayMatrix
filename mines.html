<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>PlayMatrix Mines</title>
    <script>
    if (window.history.replaceState) {
        // mines.html yazƒ±sƒ±nƒ± silip sadece playmatrix.com.tr g√∂r√ºnmesini saƒülar
        window.history.replaceState(null, null, "/");
    }
</script>

<style>
    /* RESET & TEMEL STƒ∞LLER */
    *{margin:0;padding:0;box-sizing:border-box;-webkit-tap-highlight-color:transparent;touch-action:manipulation;}
    html,body{
        height:100%; overflow:hidden; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
        background: #020408; color:white;
    }

    /* TOP BAR */
    .top-bar{
        position:fixed;top:0;width:100%;height:70px;
        display:flex;align-items:center;justify-content:space-between;
        padding:0 15px; background: rgba(0,0,0,0.95);
        border-bottom: 2px solid #4fd1ff; z-index:1000;
    }

    .brand{
        font-family: -apple-system, sans-serif; font-size:1.1rem; font-weight:900; color:#4fd1ff;
        letter-spacing: 1px;
    }

    .right-menu{display:flex;gap:8px;align-items: center;}
    
    .user-pill-mini { 
        display: flex; align-items: center; gap: 8px; 
        background: rgba(255,255,255,0.05); padding: 5px 12px; 
        border-radius: 12px; border: 1px solid rgba(255,255,255,0.1); 
        height: 38px;
    }
    .balance-info { display: flex; align-items: center; }
    .balance-info b { font-size: 14px; color: #00ffa3; font-weight: 700; }
    .mc-chip {
        width: 22px; height: 22px;
        background: radial-gradient(circle at 30% 30%, #4fd1ff, #0055ff);
        border-radius: 50%; margin-left: 6px;
        display: flex; align-items: center; justify-content: center;
        font-size: 8px; font-weight: 900; color: #fff;
        box-shadow: 0 0 10px rgba(79, 209, 255, 0.3);
        border: 1.2px solid rgba(255,255,255,0.2);
    }

    .back-btn {
        background: #ff3b30; color: white; text-decoration: none; padding: 8px 12px;
        border-radius: 4px; font-size: 0.7rem; font-weight: 900; 
        clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%);
        height: 32px; display: flex; align-items: center; margin-left: 5px;
    }

    /* OYUN ALANI */
    .container{
        position:absolute;top:70px;bottom:0;width:100%;
        display:flex;flex-direction:column;padding:15px;overflow-y:auto;
        background-color: #020408;
        background-image: 
            radial-gradient(at 0% 0%, hsla(225,39%,10%,1) 0, transparent 50%), 
            radial-gradient(at 50% 0%, hsla(225,39%,15%,1) 0, transparent 50%), 
            radial-gradient(at 100% 0%, hsla(225,39%,10%,1) 0, transparent 50%), 
            radial-gradient(at 50% 50%, hsla(225,39%,5%,1) 0, transparent 100%),
            linear-gradient(180deg, #020408 0%, #0a0f1e 100%);
        background-attachment: fixed;
    }

    .container::before {
        content: "";
        position: fixed;
        top: 0; left: 0; width: 100%; height: 100%;
        background: radial-gradient(circle at 50% 50%, rgba(79, 209, 255, 0.03) 0%, transparent 70%);
        pointer-events: none;
        animation: pulseBg 8s infinite alternate;
    }

    @keyframes pulseBg {
        0% { opacity: 0.5; transform: scale(1); }
        100% { opacity: 1; transform: scale(1.2); }
    }

    .mines-header{
        display:flex;justify-content:space-between;align-items:center;
        background:rgba(26, 34, 72, 0.4); padding:12px 15px; border-radius:14px; 
        margin-bottom:15px; border: 1px solid rgba(79, 209, 255, 0.1);
        backdrop-filter: blur(5px);
        z-index: 2;
    }
    
    #grid{display:grid;grid-template-columns:repeat(5,1fr);gap:10px;margin-bottom:20px; z-index: 2;}
    
    .tile{
        background: rgba(22, 29, 54, 0.7); height: 65px; border-radius: 12px; 
        display: flex; align-items: center; justify-content: center; 
        font-size: 24px; cursor: pointer; transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid rgba(39, 60, 143, 0.5);
        backdrop-filter: blur(2px);
    }

    .tile.active-hover:hover {
        background: rgba(30, 40, 75, 0.9);
        border-color: #4fd1ff;
        transform: translateY(-2px);
    }

    .tile.open{ 
        background: linear-gradient(145deg, #00b894, #00d2ad); 
        border-color: #55efc4; 
        box-shadow: 0 0 15px rgba(0, 184, 148, 0.4);
        animation: flip 0.4s; 
        cursor: default;
    }
    
    .tile.mine{ 
        background: linear-gradient(145deg, #d63031, #ff7675); 
        border-color: #ff7675; 
        box-shadow: 0 0 20px rgba(214, 48, 49, 0.5);
        animation: shake 0.3s; 
        cursor: default;
    }

    /* Oyun bitince a√ßƒ±lmayanlarƒ± soluk g√∂stermek i√ßin */
    .tile.dimmed-diamond {
        background: rgba(22, 29, 54, 0.3);
        border-color: rgba(39, 60, 143, 0.2);
        opacity: 0.5;
        cursor: default;
    }
    
    .tile.dimmed-mine {
        background: rgba(214, 48, 49, 0.2);
        border-color: rgba(214, 48, 49, 0.3);
        opacity: 0.7;
        cursor: default;
    }

    @keyframes flip { 0% {transform: rotateY(90deg);} 100% {transform: rotateY(0deg);} }
    @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-4px)} 75%{transform:translateX(4px)}}

    .bet-panel{
        background: rgba(10, 15, 30, 0.85); 
        border-top: 1px solid rgba(79, 209, 255, 0.1);
        padding: 20px 15px; margin: auto -15px 0 -15px;
        display: flex; flex-direction: column; gap: 10px;
        backdrop-filter: blur(10px);
        z-index: 10;
    }

    input, select{
        width:100%; background: rgba(5, 8, 17, 0.8); border: 1px solid #273c8f; 
        border-radius:12px; padding:12px; color:white; 
        font-weight: bold; font-size:16px; outline:none; text-align: center;
        -webkit-appearance: none;
        transition: border-color 0.3s;
    }

    input:focus { border-color: #4fd1ff; }
    input:disabled, select:disabled { opacity: 0.5; cursor: not-allowed; }

    button{
        width:100%; padding:15px; border-radius:12px; border:none; 
        font-weight:900; cursor:pointer; font-size:16px; 
        background: linear-gradient(180deg, #6c5ce7 0%, #5743d6 100%);
        color:white; transition: 0.2s;
        box-shadow: 0 4px 15px rgba(87, 67, 214, 0.3);
    }

    button:active { transform: scale(0.98); }
    button:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .start-active{ background: linear-gradient(180deg, #00d2ad 0%, #00b894 100%) !important; box-shadow: 0 4px 15px rgba(0, 184, 148, 0.3); }
    .is-lose{ background: linear-gradient(180deg, #ff7675 0%, #d63031 100%) !important; box-shadow: 0 4px 15px rgba(214, 48, 49, 0.3); }

    /* UYARI / Bƒ∞LGƒ∞ MODALI */
    .modal-overlay {
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.8); backdrop-filter: blur(5px);
        display: none; align-items: center; justify-content: center; z-index: 2000;
    }
    .modal-content {
        background: #161d36; border: 2px solid #273c8f; border-radius: 20px;
        width: 85%; max-width: 320px; padding: 25px; text-align: center;
        box-shadow: 0 0 30px rgba(0,0,0,0.5); animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    }
    .modal-icon { font-size: 40px; margin-bottom: 15px; color: #ff2a4d; }
    .modal-text { font-weight: 700; font-size: 16px; line-height: 1.5; margin-bottom: 20px; }
    .modal-btn {
        background: #4fd1ff; color: #000; padding: 10px 25px; border-radius: 10px;
        font-weight: 900; border: none; cursor: pointer; width: auto !important;
    }
    
    @keyframes pop { 0% {transform: scale(0.8); opacity: 0;} 100% {transform: scale(1); opacity: 1;} }

    /* YENƒ∞: Sƒ∞STEM BA≈ûLATMA OVERLAY EKRANI (SES Kƒ∞Lƒ∞Dƒ∞ ƒ∞√áƒ∞N) */
    .start-overlay {
        position: fixed; inset: 0; background: rgba(2,4,10,0.95);
        display: flex; align-items: center; justify-content: center;
        z-index: 9999; backdrop-filter: blur(10px); flex-direction: column;
    }
    .start-modal {
        background: rgba(10,15,25,0.95); padding: 40px; border-radius: 20px; 
        text-align: center; border: 2px solid #4fd1ff; box-shadow: 0 0 30px rgba(79,209,255,0.2);
        width: 85%; max-width: 350px;
    }
</style>
</head>
<body>

<div id="sys-start-overlay" class="start-overlay">
    <div class="start-modal">
        <h2 style="font-family:'Orbitron', sans-serif; color:#4fd1ff; font-size: 24px; margin-bottom: 10px; text-shadow: 0 0 15px rgba(79,209,255,0.5);">Mƒ∞NES PROTOKOL√ú</h2>
        <p style="font-size: 12px; color: #94a3b8; margin-bottom: 25px;">Sesleri ve oyun motorunu aktifle≈ütirmek i√ßin sistemi ba≈ülatƒ±n.</p>
        <button id="systemStartBtn" style="width: 100%; padding: 15px; border-radius: 12px; border: none; background: linear-gradient(90deg, #00ffa3, #00b894); color: #000; font-weight: 900; font-size: 16px; cursor: pointer;">Sƒ∞STEMƒ∞ BA≈ûLAT</button>
    </div>
</div>

<div class="top-bar">
    <div class="brand">Mƒ∞NES</div>
    <div class="right-menu">
        <div class="user-pill-mini">
            <div class="balance-info">
                <b id="userBalance">0</b>
                <div class="mc-chip">MC</div>
            </div>
        </div>
        
        <div class="user-pill-mini" style="border-color: #ffcc00;">
            <div class="balance-info">
                <b id="currentBet" style="color:#ffcc00">0</b>
                <div class="mc-chip" style="background: radial-gradient(circle at 30% 30%, #ffcc00, #ff8a00); box-shadow: 0 0 10px rgba(255, 204, 0, 0.3);">MC</div>
            </div>
        </div>

        <a href="index.html" class="back-btn">GERƒ∞</a>
    </div>
</div>

<div class="container">
    <div class="mines-header">
        <div style="font-weight: 800; color: #4fd1ff; font-size: 14px; letter-spacing: 0.5px;">MULTIPLIER: <span id="multiplierDisplay" style="color:white;">1.00x</span></div>
        <div style="color:#aaa; font-size: 12px; font-weight: 700;">MAYIN: <span id="mineDisplay" style="color:#ff2a4d;">1</span></div>
    </div>
    <div id="grid"></div>
    <div class="bet-panel">
        <input type="number" id="bet" placeholder="Bahis Miktarƒ±" value="250" inputmode="numeric">
        <select id="mineCount"></select>
        <button id="startBtn">MC KULLAN</button>
    </div>
</div>

<div id="alertModal" class="modal-overlay">
    <div class="modal-content">
        <div class="modal-icon" id="modalIcon">‚ö†Ô∏è</div>
        <div class="modal-text" id="modalMsg">Hata olu≈ütu.</div>
        <button class="modal-btn" onclick="closeModal()">TAMAM</button>
    </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, onAuthStateChanged, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
import { getFirestore, doc, onSnapshot, runTransaction } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

const firebaseConfig = {
    apiKey: "AIzaSyBykwXCOJpX6rG0pUx93HmALjVcCQWVMYA",
    authDomain: "emirhan-site.firebaseapp.com",
    projectId: "emirhan-site",
    storageBucket: "emirhan-site.firebasestorage.app",
    messagingSenderId: "668871888390",
    appId: "1:668871888390:web:76568bda84cb1641f7bd87"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// --- MODAL Y√ñNETƒ∞Mƒ∞ ---
window.showModal = (msg, isSuccess = false) => {
    document.getElementById("modalIcon").innerText = isSuccess ? "‚úÖ" : "‚ö†Ô∏è";
    document.getElementById("modalIcon").style.color = isSuccess ? "#00ffa3" : "#ff2a4d";
    document.getElementById("modalMsg").innerText = msg;
    document.getElementById("alertModal").style.display = "flex";
}
window.closeModal = () => {
    document.getElementById("alertModal").style.display = "none";
}

// --- PROFESYONEL SES Sƒ∞STEMƒ∞ (Autoplay Kƒ±rƒ±cƒ±) ---
let audioCtx = null;
const sounds = {};

async function initAudio() {
    if (audioCtx) return;
    try {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        if (audioCtx.state === 'suspended') audioCtx.resume();
        
        // Sessiz frekans tetikleyici (iOS / Chrome Autoplay Policy i√ßin)
        const buffer = audioCtx.createBuffer(1, 1, 22050);
        const source = audioCtx.createBufferSource();
        source.buffer = buffer;
        source.connect(audioCtx.destination);
        source.start(0);

        // Uzak ses dosyalarƒ±
        const urls = {
            bet: 'https://assets.mixkit.co/active_storage/sfx/2571/2571-preview.mp3',
            open: 'https://assets.mixkit.co/active_storage/sfx/2017/2017-preview.mp3',
            explode: 'https://assets.mixkit.co/active_storage/sfx/2802/2802-preview.mp3',
            win: 'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'
        };
        for (const [name, url] of Object.entries(urls)) {
            try {
                const res = await fetch(url);
                const buf = await res.arrayBuffer();
                sounds[name] = await audioCtx.decodeAudioData(buf);
            } catch (e) {
                console.warn(`Ses y√ºklenemedi: ${name}`, e);
            }
        }
    } catch (e) { console.error("Ses sistemi ba≈ülatƒ±lamadƒ±:", e); }
}

// Sistemi Ba≈ülat Butonu Tƒ±klamasƒ±
document.getElementById('systemStartBtn').addEventListener('click', () => {
    initAudio();
    document.getElementById('sys-start-overlay').style.display = 'none';
});

function playSound(name) {
    if (!audioCtx || !sounds[name]) return;
    if (audioCtx.state === 'suspended') audioCtx.resume();
    const source = audioCtx.createBufferSource();
    source.buffer = sounds[name];
    source.connect(audioCtx.destination);
    source.start(0);
}

// --- OYUN DEƒûƒ∞≈ûKENLERƒ∞ ---
let opened = 0;
let betAmount = 0;
let mineTotal = 1;
let currentMultiplier = 1.00;
let gameActive = false;
let isProcessing = false; // Firestore i≈ülemleri s√ºrerken Race Condition'ƒ± engeller
let tileElements = [];

// DOM Elementleri
const gridEl = document.getElementById("grid");
const balanceText = document.getElementById("userBalance");
const currentBetText = document.getElementById("currentBet");
const startBtn = document.getElementById("startBtn");
const mineSelect = document.getElementById("mineCount");
const betInput = document.getElementById("bet");
const mineDisplay = document.getElementById("mineDisplay");
const multiplierDisplay = document.getElementById("multiplierDisplay");

// Mayƒ±n Sayƒ±sƒ± Se√ßeneklerini Olu≈ütur (1-24)
for(let i=1; i<=24; i++){
    let opt = document.createElement("option");
    opt.value = i; opt.text = i + " MAYIN";
    mineSelect.appendChild(opt);
}
// 3 mayƒ±n default olsun
mineSelect.value = 3;
mineDisplay.innerText = "3";

mineSelect.addEventListener("change", () => mineDisplay.innerText = mineSelect.value);

// Izgarayƒ± Olu≈ütur
function createGrid() {
    gridEl.innerHTML = "";
    tileElements = [];
    for(let i=0; i<25; i++){
        let tile = document.createElement("div");
        tile.classList.add("tile", "active-hover");
        tile.dataset.index = i;
        tile.addEventListener("click", () => handleTileClick(i, tile));
        gridEl.appendChild(tile);
        tileElements.push(tile);
    }
}

// √áarpan Hesaplama (Matematiksel Olasƒ±lƒ±k + Kasa Payƒ±)
function calculateMultiplier(nMines, nOpened) {
    if(nOpened === 0) return 1.00;
    
    // A√ßƒ±lacak ta≈ü kalmadƒ±ysa
    if (25 - nMines - nOpened < 0) return 0;

    let probability = 1;
    for (let i = 0; i < nOpened; i++) {
        probability *= (25 - nMines - i) / (25 - i);
    }
    
    // Kasa %3 Avantajƒ± (House Edge)
    let mult = (1 / probability) * 0.97;
    return Math.floor(mult * 100) / 100; // Sonucu 2 ondalƒ±klƒ± hale getir (√ñrn: 1.15)
}

// OYUNU BA≈ûLAT / KAZANCI √áEK BUTONU
startBtn.addEventListener("click", async () => {
    if (isProcessing) return; // ƒ∞≈ülem bitene kadar tƒ±klanamaz (G√ºvenlik)
    if (!auth.currentUser) return;
    const userRef = doc(db, "users", auth.currentUser.uid);

    // DURUM 1: OYUN ZATEN AKTƒ∞FSE (KAZANCI √áEKME ƒ∞≈ûLEMƒ∞)
    if (gameActive) {
        if (opened === 0) return; // Hi√ß ta≈ü a√ßƒ±lmadƒ±ysa bo≈ü yere √ßekilemez
        
        isProcessing = true;
        startBtn.disabled = true;
        gameActive = false; // Oyunu hemen kitle ki ba≈üka ta≈üa basamasƒ±n
        
        const winAmount = Math.floor(betAmount * currentMultiplier);
        
        try {
            await runTransaction(db, async (t) => {
                const snap = await t.get(userRef);
                t.update(userRef, { balance: snap.data().balance + winAmount });
            });
            playSound("win");
            revealAllMines(false); // Kazanƒ±ldƒ±, mayƒ±nlarƒ± inandƒ±rƒ±cƒ± ≈üekilde s√∂n√ºk g√∂ster
            showModal(`TEBRƒ∞KLER! ${winAmount.toLocaleString('tr-TR')} MC KAZANDINIZ.`, true);
        } catch (e) {
            console.error("Para √ßekme hatasƒ±:", e);
            showModal("Kazan√ß i≈ülenirken bir hata olu≈ütu.");
        } finally {
            resetGame();
        }
        return;
    }

    // DURUM 2: YENƒ∞ OYUN BA≈ûLAT (BAHƒ∞S YAPMA ƒ∞≈ûLEMƒ∞)
    betAmount = parseInt(betInput.value);
    
    if(isNaN(betAmount) || betAmount < 100) {
        showModal("Minimum bahis 100 MC olmalƒ±dƒ±r!");
        return;
    }
    if(betAmount > 100000) {
        showModal("Maksimum bahis 100.000 MC olabilir!");
        return;
    }

    isProcessing = true;
    startBtn.disabled = true;

    try {
        await runTransaction(db, async (t) => {
            const snap = await t.get(userRef);
            if (snap.data().balance < betAmount) throw "MC BAKƒ∞YE YETERSƒ∞Z!";
            t.update(userRef, { balance: snap.data().balance - betAmount });
        });
        
        playSound("bet");
        
        // Oyun Deƒüi≈ükenlerini Sƒ±fƒ±rla ve Ba≈ülat
        opened = 0; 
        currentMultiplier = 1.00;
        mineTotal = parseInt(mineSelect.value);
        multiplierDisplay.innerText = "1.00x";
        
        createGrid(); // Tahtayƒ± yenile
        
        gameActive = true;
        betInput.disabled = true; 
        mineSelect.disabled = true;
        
        currentBetText.innerText = betAmount.toLocaleString('tr-TR');
        startBtn.innerText = "TA≈û SE√áƒ∞N";
        startBtn.classList.add("start-active");
        
    } catch (e) { 
        showModal(typeof e === "string" ? e : "Bahis alƒ±namadƒ±."); 
    } finally {
        isProcessing = false;
        startBtn.disabled = false;
    }
});

// TA≈ûA TIKLAMA VE KASA ALGORƒ∞TMASI (Schr√∂dinger'in Mayƒ±nƒ±)
function handleTileClick(index, tile) {
    // Oyun aktif deƒüilse, i≈ülem s√ºr√ºyorsa veya ta≈ü zaten a√ßƒ±ksa yoksay
    if (!gameActive || isProcessing || tile.classList.contains("open")) return;
    
    // --- KASA (HOUSE) ALGORƒ∞TMASI ---
    // Mayƒ±nlar en ba≈ütan dizilmez! Oyuncu ta≈üa tƒ±kladƒ±ƒüƒ± AN o ta≈üƒ±n mayƒ±n olup olmadƒ±ƒüƒ±na karar verilir.
    // Bu y√∂ntem, "√ñƒüeyi ƒ∞ncele (F12)" √ºzerinden hile yapƒ±lmasƒ±nƒ± %100 engeller.
    
    let isMineHit = false;
    let crashChance = 0;

    const remainingTiles = 25 - opened;
    const baseRisk = mineTotal / remainingTiles; // Normal matematiksel ihtimal
    
    // Kasayƒ± Koruma: √áarpan √ßok y√ºkselirse veya mayƒ±n sayƒ±sƒ± √ßoksa patlama ihtimalini "Yapay (Hileli)" olarak artƒ±r.
    if (opened > 0) {
        if (currentMultiplier >= 10.0) crashChance = baseRisk + 0.35; // %35 Ekstra patlama ≈üansƒ± (√áok Riskli)
        else if (currentMultiplier >= 4.0) crashChance = baseRisk + 0.15; // %15 Ekstra ≈üans
        else if (currentMultiplier >= 2.0) crashChance = baseRisk + 0.05; // %5 Ekstra ≈üans
        else crashChance = baseRisk; // Ba≈ülangƒ±√ß seviyelerinde normal adil ihtimal
    } else {
        crashChance = baseRisk; // ƒ∞lk tƒ±klama her zaman normale en yakƒ±n ihtimaldir
    }

    // Zar Atƒ±≈üƒ±
    if (Math.random() < crashChance) {
        isMineHit = true;
    }

    // --- TIKLAMA SONUCU ---
    if (isMineHit) {
        // MAYINA BASTI VE KAYBETTƒ∞
        gameActive = false;
        playSound("explode");
        
        tile.classList.add("mine");
        tile.innerHTML = "üí£";
        tile.classList.remove("active-hover");
        
        startBtn.innerText = "KAYBETTƒ∞N!";
        startBtn.classList.remove("start-active");
        startBtn.classList.add("is-lose");
        
        revealAllMines(true, index); // Geri kalan mayƒ±nlarƒ± ekrana rastgele inandƒ±rƒ±cƒ± ≈üekilde diz
        
        setTimeout(resetGame, 2500); // 2.5 sn sonra oyunu sƒ±fƒ±rla
        
    } else {
        // G√úVENLƒ∞ TA≈û - ELMAS √áIKTI
        opened++;
        tile.classList.add("open");
        tile.innerHTML = "üíé";
        tile.classList.remove("active-hover");
        playSound("open");
        
        currentMultiplier = calculateMultiplier(mineTotal, opened);
        multiplierDisplay.innerText = currentMultiplier.toFixed(2) + "x";
        
        const currentWin = Math.floor(betAmount * currentMultiplier);
        startBtn.innerText = `√áEK (MC ${currentWin.toLocaleString('tr-TR')})`;
        
        // Eƒüer t√ºm g√ºvenli ta≈ülar a√ßƒ±ldƒ±ysa (Oyunu tamamen bitirdiyse) otomatik olarak kazancƒ± √ßek
        if (opened === (25 - mineTotal)) {
            startBtn.click(); 
        }
    }
}

// OYUN Bƒ∞TTƒ∞ƒûƒ∞NDE TAHTAYI ƒ∞NANDIRICI ≈ûEKƒ∞LDE DOLDUR (Sahte Mayƒ±n Daƒüƒ±tƒ±mƒ±)
function revealAllMines(isLoss, hitIndex = -1) {
    let fakeMines = [];
    if (isLoss) fakeMines.push(hitIndex); // Patlayan ana mayƒ±n listemizde olsun
    
    // Kalan mayƒ±nlarƒ± tahtadaki a√ßƒ±lmamƒ±≈ü, bo≈ü yerlere rastgele daƒüƒ±tƒ±yoruz
    while (fakeMines.length < mineTotal) {
        let r = Math.floor(Math.random() * 25);
        if (!fakeMines.includes(r) && !tileElements[r].classList.contains("open")) {
            fakeMines.push(r);
        }
    }

    // T√ºm tahtayƒ± g√∂rsel olarak g√ºncelle
    tileElements.forEach((tile, i) => {
        tile.classList.remove("active-hover");
        if (tile.classList.contains("open")) return; // Zaten a√ßƒ±k olan elmaslara dokunma
        
        if (fakeMines.includes(i)) {
            if (i !== hitIndex) { // Patlamayan (g√∂sterilen) mayƒ±nlar
                tile.innerHTML = "üí£";
                tile.classList.add("dimmed-mine");
            }
        } else {
            // Mayƒ±n olmayan kalan kapalƒ± ta≈ülar s√∂n√ºk elmas olur
            tile.innerHTML = "üíé";
            tile.classList.add("dimmed-diamond");
        }
    });
}

// OYUNU ƒ∞LK (BEKLEME) HALƒ∞NE D√ñND√úR
function resetGame() {
    isProcessing = false;
    gameActive = false;
    betInput.disabled = false;
    mineSelect.disabled = false;
    startBtn.innerText = "MC KULLAN";
    startBtn.classList.remove("start-active", "is-lose");
    currentBetText.innerText = "0";
    multiplierDisplay.innerText = "1.00x";
    createGrid(); 
}

// Fƒ∞REBASE KULLANICI Dƒ∞NLEYƒ∞Cƒ∞Sƒ∞ (Bakiye G√ºncelleme)
onAuthStateChanged(auth, user => {
    if (!user) {
        signInAnonymously(auth); // Kullanƒ±cƒ± yoksa otomatik misafir olu≈ütur (Test i√ßin)
        return;
    }
    // Bakiyeyi anlƒ±k olarak dinle ve UI'a yansƒ±t
    onSnapshot(doc(db, "users", user.uid), snap => {
        if (snap.exists()) {
            const bal = snap.data().balance || 0;
            balanceText.innerText = Math.floor(bal).toLocaleString('tr-TR');
        }
    });
});

// Sayfa y√ºklendiƒüinde ilk ƒ±zgarayƒ± olu≈ütur
createGrid();
</script>
</body>
</html>
