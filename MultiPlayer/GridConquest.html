<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'none'; connect-src 'self' https://emirhan-siye.onrender.com https://identitytoolkit.googleapis.com https://securetoken.googleapis.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com; media-src https://cdn.pixabay.com; img-src 'self' data: https://encrypted-tbn0.gstatic.com; script-src 'self' 'unsafe-inline' https://www.gstatic.com;">

    <title>PlayMatrix Neon Conquest | Çok Oyunculu Alan Ele Geçirme Oyunu</title>
    <meta name="description" content="Neon Conquest oyna! Rakiplerinle online arenada kapış, stratejini konuştur ve saniyeler içinde alanı ele geçirerek zafer kazan.">
    <meta name="theme-color" content="#03050a">

    <link href="https://fonts.googleapis.com/css2?family=Black+Ops+One&family=Rajdhani:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <style>
        :root {
            --p1: #ff0055; --p2: #00f2ff; --bg: #03050a;
            --glass: rgba(18, 22, 33, 0.98); --border: #ffcc00;
            --danger: #ff2d55; --warning: #ffb800; --accent: #7d00ff;
            --btn-main: #ffcc00; --btn-sec: #00f2ff;
        }

        /* EKRAN KAYMASI, ZOOM VE SEÇİM KESİN ENGELLEME */
        html, body { 
            background: var(--bg); color: #e0e0e0; 
            width: 100vw; height: 100vh; overflow: hidden; 
            display: flex; flex-direction: column; position: fixed; 
            top: 0; left: 0; overscroll-behavior: none; touch-action: none; 
            user-select: none; -webkit-user-select: none; -webkit-touch-callout: none;
        }

        * { margin:0; padding:0; box-sizing:border-box; font-family: 'Rajdhani', sans-serif; -webkit-tap-highlight-color: transparent; }

        input { touch-action: auto; user-select: auto; -webkit-user-select: auto; }

        .sr-only { position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px; overflow: hidden; clip: rect(0, 0, 0, 0); white-space: nowrap; border-width: 0; }
        #bg-canvas { position: fixed; inset: 0; z-index: -1; background: #000; pointer-events: none; }

        /* ÜST BAR TAŞMA KORUMASI */
        .header { height: 70px; flex-shrink: 0; padding: 0 15px; display: flex; align-items: center; justify-content: space-between; background: rgba(0,0,0,0.95); border-bottom: 2px solid var(--border); z-index: 1000; touch-action: none; gap: 10px; }
        .logo { font-family: 'Black Ops One'; font-size: 1.1rem; color: var(--border); letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center; flex: 1; }
        .user-badge { font-weight: 700; color: var(--p2); font-size: 0.8rem; border-left: 2px solid var(--p2); padding-left: 8px; max-width: 80px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex-shrink: 0; }
        #btnExit { flex-shrink: 0; background:var(--danger); border:none; color:white; padding:8px 12px; font-weight:900; font-size:0.7rem; clip-path: polygon(10% 0, 100% 0, 90% 100%, 0 100%); cursor:pointer; touch-action: manipulation; }

        #lobby { flex: 1; padding: 20px; display: flex; flex-direction: column; gap: 15px; overflow-y: auto; z-index: 10; touch-action: pan-y; overscroll-behavior: contain; }
        .search-input { width: 100%; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,204,0,0.3); padding: 12px 15px; color: #fff; border-radius: 4px; outline: none; margin-bottom: 5px; flex-shrink: 0; }
        
        .btn-neon { background: var(--btn-main); color: #000; border: none; padding: 15px; font-family: 'Black Ops One'; font-size: 0.85rem; cursor: pointer; clip-path: polygon(4% 0, 100% 0, 96% 100%, 0 100%); transition: 0.3s; touch-action: manipulation; flex-shrink: 0; }
        .btn-neon:disabled { opacity: 0.3; cursor: not-allowed; }
        .btn-sec { background: var(--btn-sec); }

        .room-card { background: var(--glass); border: 1px solid rgba(255, 204, 0, 0.2); border-left: 5px solid var(--border); padding: 15px; display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; border-radius: 6px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); animation: slideIn 0.4s cubic-bezier(0.18, 0.89, 0.32, 1.28); }
        .room-info { display: flex; flex-direction: column; gap: 4px; text-align: left; overflow: hidden; }
        .room-title { font-family: 'Black Ops One'; font-size: 1.1rem; color: var(--border); letter-spacing: 1px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .room-players { font-size: 0.95rem; font-weight: 700; color: #fff; display:flex; align-items: center; gap: 5px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;}
        .room-time { font-size: 0.75rem; color: #888; font-weight: 700; background: rgba(255,255,255,0.05); padding: 2px 6px; border-radius: 4px; display: inline-block; width: fit-content;}
        .room-action .btn-neon { padding: 12px 18px; font-size: 0.75rem; border-radius: 0; }

        @keyframes slideIn { from { opacity:0; transform: translateY(20px); } to { opacity:1; transform: translateY(0); } }

        .how-to-btn { position: fixed; bottom: 20px; right: 20px; padding: 10px 20px; background: var(--border); color: #000; border-radius: 30px; font-weight: 900; font-size: 0.8rem; cursor: pointer; z-index: 100; box-shadow: 0 0 20px rgba(255,204,0,0.3); border: none; font-family: 'Black Ops One'; touch-action: manipulation; }

        #game-view { display: none; flex: 1; flex-direction: column; z-index: 10; touch-action: none; position: relative; }
        
        /* OYUN ÜST BAR TAŞMA KORUMASI */
        .game-hud { height: 90px; flex-shrink: 0; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center; gap: 10px; background: rgba(0,0,0,0.8); touch-action: none; padding: 0 10px; }
        .player-hud { display: flex; flex-direction: column; align-items: center; justify-content: center; min-width: 0; }
        .player-name { font-weight: bold; font-size: 0.9rem; text-transform: uppercase; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 100%; text-align: center; }
        .score-num { font-family: 'Black Ops One'; font-size: 2.2rem; line-height: 1; }
        #timer-display { font-family: 'Black Ops One'; font-size: 1.5rem; color: var(--warning); border: 2px solid var(--warning); border-radius: 50%; width: 55px; height: 55px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin: 0 auto; }

        .grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 6px; width: 95vw; max-width: 400px; margin: auto; padding: 10px; touch-action: none; position: relative; }
        .cell { aspect-ratio: 1/1; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); transition: background 0.1s, box-shadow 0.1s; cursor: pointer; touch-action: none; pointer-events: auto; }
        .cell.p1 { background: var(--p1); box-shadow: 0 0 15px var(--p1); border-color: var(--p1); }
        .cell.p2 { background: var(--p2); box-shadow: 0 0 15px var(--p2); border-color: var(--p2); }

        /* Oyun Başlamadan Önce Grid Kilidi */
        #gameOverlay { position: absolute; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(3px); z-index: 50; display: flex; align-items: center; justify-content: center; font-family: 'Black Ops One'; font-size: 1.5rem; color: var(--border); text-align: center; text-shadow: 0 0 20px var(--border); pointer-events: all; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); backdrop-filter: blur(15px); display: none; align-items: center; justify-content: center; z-index: 9000; padding: 20px; touch-action: none; }
        .modal-box { background: #0d1117; border: 2px solid var(--border); padding: 30px; width: 100%; max-width: 360px; text-align: center; position: relative; box-shadow: 0 0 50px rgba(255,204,0,0.1); }
        .modal-box h3 { font-family: 'Black Ops One'; color: var(--border); margin-bottom: 20px; font-size: 1.4rem; letter-spacing: 1px; }
        .modal-input { width: 100%; background: #161b22; border: 1px solid #30363d; padding: 14px; color: #fff; margin-bottom: 15px; text-align: center; outline: none; font-size: 1rem; }
        
        .error-text { color: var(--danger); font-size: 0.8rem; font-weight: 700; margin-top: -10px; margin-bottom: 15px; display: none; }

        .result-header { font-size: 3.5rem; font-family: 'Black Ops One'; text-transform: uppercase; margin-bottom: 10px; }
        .win-text { color: var(--btn-sec); text-shadow: 0 0 20px var(--btn-sec); }
        .lose-text { color: var(--danger); text-shadow: 0 0 20px var(--danger); }
        .final-score { font-size: 2.5rem; margin: 20px 0; display: flex; justify-content: center; gap: 20px; align-items: center; }
        .score-box { background: rgba(255,255,255,0.05); padding: 10px 20px; border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }
    </style>

    <script>
        // Çift tıklama ile yakınlaştırmayı (Zoom) ve kaydırmayı kökten bloke eden script
        document.addEventListener('dblclick', function(event) { event.preventDefault(); }, { passive: false });
        document.addEventListener('gesturestart', function(event) { event.preventDefault(); }, { passive: false });
    </script>
</head>
<body>

    <h1 class="sr-only">PlayMatrix Neon Conquest</h1>
    <canvas id="bg-canvas" aria-label="Arka Plan Animasyonu"></canvas>

    <header class="header">
        <div class="user-badge" id="meName">YÜKLENİYOR...</div>
        <div class="logo">NEON CONQUEST</div>
        <button id="btnExit" aria-label="Oyundan Çıkış Yap">AYRIL</button>
    </header>

    <main id="lobby">
        <div class="search-container">
            <input type="text" id="roomSearch" class="search-input" placeholder="ARENA ARA..." aria-label="Açık Arenaları Ara">
        </div>
        <button class="btn-neon" id="createRoomBtn" disabled aria-label="Yeni Arena Oluştur">ARENA OLUŞTUR</button>
        <button class="btn-neon btn-sec" id="quickJoinBtn" disabled aria-label="Hızlı Savaşa Katıl">HIZLI SAVAŞ</button>
        <div id="emptyLobbyMsg" style="text-align: center; margin-top: 50px; opacity: 0.3; font-family: 'Black Ops One'; letter-spacing: 5px;">LOBİ BOŞ</div>
        <div id="roomList" aria-live="polite"></div>
    </main>

    <button class="how-to-btn" id="btnHelp" aria-label="Oyun Nasıl Oynanır Rehberi">Nasıl Oynanılır ?</button>

    <div id="game-view" aria-label="Savaş Arenası">
        <div class="game-hud">
            <div class="player-hud" style="color:var(--p1);">
                <div class="player-name" id="n1">-</div>
                <div class="score-num" id="s1">0</div>
            </div>
            <div id="timer-display" aria-live="polite" aria-label="Kalan Süre">60</div>
            <div class="player-hud" style="color:var(--p2);">
                <div class="player-name" id="n2">-</div>
                <div class="score-num" id="s2">0</div>
            </div>
        </div>
        
        <div style="position: relative; margin: auto;">
            <div id="gameOverlay">RAKİP BEKLENİYOR...</div>
            <div class="grid" id="grid" role="grid" aria-label="Ele Geçirilecek Alanlar"></div>
        </div>
    </div>

    <div id="roomTypeModal" class="modal" aria-hidden="true"><div class="modal-box"><h3>ARENA TİPİ</h3><button class="btn-neon" id="btnPublicArena" style="width:100%; margin-bottom:12px;">AÇIK ARENA</button><button class="btn-neon btn-sec" id="btnPrivateArena" style="width:100%">KİLİTLİ ARENA</button><p id="btnCancelType" style="margin-top:20px; cursor:pointer; color:#666;">İPTAL</p></div></div>
    <div id="privateSettingsModal" class="modal" aria-hidden="true"><div class="modal-box"><h3>ARENA KURULUMU</h3><input type="number" id="customRoomPass" class="modal-input" placeholder="ŞİFRE (Min 5 Sayı)" aria-label="Oda Şifresi"><div id="createError" class="error-text">HATA: ŞİFRE EN AZ 5 SAYI!</div><button class="btn-neon" id="btnCreatePrivate" style="width:100%">OLUŞTUR</button><p id="btnCancelPrivate" style="margin-top:20px; cursor:pointer; color:#666;">GERİ</p></div></div>
    <div id="passwordEntryModal" class="modal" aria-hidden="true"><div class="modal-box"><h3>ŞİFRE GEREKLİ</h3><input type="number" id="joinRoomPassInput" class="modal-input" placeholder="ŞİFREYİ GİRİN" aria-label="Oda Giriş Şifresi"><div id="passError" class="error-text">HATA: ŞİFRE YANLIŞ!</div><button class="btn-neon" id="confirmJoinPass" style="width:100%">GİRİŞ YAP</button><button class="btn-neon btn-sec" id="btnCancelJoinPass" style="width:100%; margin-top:10px;">İPTAL</button></div></div>
    <div id="alertModal" class="modal" aria-live="assertive"><div class="modal-box"><h3 id="alertTitle">UYARI</h3><p id="alertMsg" style="color:#aaa; margin-bottom:20px; font-weight:700;"></p><button class="btn-neon" id="alertOkBtn" style="width:100%">TAMAM</button><button class="btn-neon btn-sec" id="alertCancelBtn" style="width:100%; margin-top:10px; display:none;">İPTAL</button></div></div>
    <div id="helpModal" class="modal" aria-hidden="true"><div class="modal-box"><h3>OYUN REHBERİ</h3><p style="color:#aaa; font-size:0.95rem; line-height:1.7; text-align:left; border-left: 2px solid var(--border); padding-left: 15px;">• Dokunduğun kare senin rengine döner.<br>• Rakibin karesine dokunarak onu ele geçir.<br>• Tüm alanı ele geçiren veya süre bitiminde en çok alana sahip olan kazanır!</p><button class="btn-neon" id="btnUnderstand" style="width:100%; margin-top:25px;">ANLADIM</button></div></div>
    <div id="resultModal" class="modal" aria-live="assertive"><div class="modal-box"><div id="winnerLabel" class="result-header">ZAFER</div><div class="final-score"><div class="score-box" id="finalS1">0</div><div style="font-family:'Black Ops One'">VS</div><div class="score-box" id="finalS2">0</div></div><button class="btn-neon" id="btnReturnLobby" style="width:100%">LOBİYE DÖN</button></div></div>

    <script type="module" src="conquest.js"></script>
</body>
</html>
